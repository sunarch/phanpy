import{s as S,a as B,b as $e,u as Nn,c as fe,o as ws,I as w,M as ye,d as se,A as st,N as $t,e as He,f as je,L as J,g as rt,h as Un,l as vs,t as sn,R as Lt,i as Ss,p as tt,j as Ke,k as Fn,m as Ft,E as On,n as ze,q as Qe,r as ks,v as we,w as on,T as zn,x as pt,y as Bn,z as an,B as Is,C as Ts,D as qn,F as Ee,G as Cs,S as Le,H as $s,J as xs,K as Ye,O as Hn,P as Ot,Q as As,U as dt,V as Vn,W as _e,X as Gn,Y as Ls,Z as Ms,_ as Rs,$ as yt,a0 as _s,a1 as cn,a2 as Es,a3 as rn,a4 as ln}from"./useTitle-GtGoOz7a.js";import{F as U,_ as H,p as C,u as Me,w as Be,a as e,b as me,g as x,y as Mt,c as jt,M as ae,d as De,e as ut,q as de,x as Ge,S as Ps,I as Ze,A as Je,f as jn,l as dn,s as Yn,h as Wn,i as We,T as Ds,N as Ns,j as Us,P as Fs,J as Os,C as Kn,k as zs,m as it,n as Zn,o as Bs,r as qs,t as Hs,v as gt,z as Jn,B as un,D as Vs,R as Yt,E as Te,H as Gs,G as js}from"./vendor-7Tkqe_A2.js";function lt(t=()=>{},n=[]){const s=U(t);H(()=>{s.current=t},[n]),H(()=>{const o=()=>{const a=document.hidden||document.visibilityState==="hidden";s.current(!a)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const Ys=1e3*3,Ws=15e3,Ks=Be(function({isLoggedIn:n}){const[s,o]=C(!0);lt(o);const a=async(l,c,d)=>{var u;if(S.notificationsLast){const r=l.v1.notifications.list({limit:1,sinceId:S.notificationsLast.id}),{value:p}=await r.next();if(p!=null&&p.length)if(d)S.notificationsShowNew=!0;else{let f;try{const g=await l.v1.markers.fetch({timeline:"notifications"});f=(u=g==null?void 0:g.notifications)==null?void 0:u.lastReadId}catch{}f?S.notificationsShowNew=p[0].id!==f:S.notificationsShowNew=!0}}};H(()=>{let l,c;if(n&&s){const{masto:d,streaming:u,instance:r}=B();(async()=>{await a(d,r);let p=!1;u&&(c=setTimeout(()=>{(async()=>{try{p=!0,l=u.user.notification.subscribe();for await(const f of l){if(!l||!s)break;f.event==="notification"&&$e(f.payload,r,{skipThreading:!0}),S.notificationsShowNew=!0}}catch{p=!1}p||(c=setInterval(()=>{a(d,r,!0)},Ws))})()},Ys))})()}return()=>{var d;(d=l==null?void 0:l.unsubscribe)==null||d.call(l),l=null,clearTimeout(c),clearInterval(c)}},[s,n]);const i=U(),h=()=>{i.current=Date.now(),fetch("./version.json").then(l=>l.json()).then(l=>{l&&(S.appVersion=l)}).catch(l=>{})};return Nn(h,s&&1e3*60*30),lt(l=>{l&&(i.current?Date.now()-i.current>1e3*60*60&&h():h())}),Me("shift+alt+k",()=>{const l=S.settings.cloakMode;S.settings.cloakMode=!l,fe({text:`Cloak mode ${l?"disabled":"enabled"}`})}),null});function Zs(){function t(n){n.shiftKey?ws()||(S.showCompose=!0):S.showCompose=!0}return Me("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const Js=Be(function(){const n=me(S);function s(){S.showKeyboardShortcutsHelp=!1}return Me("?, shift+?, shift+slash",o=>{S.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:o=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&e(ye,{class:"light",onClose:s,children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Load new posts",keys:e("kbd",{children:"."})},{action:"Open post details",keys:e(x,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:e(x,{children:["Expand content warning or",e("br",{}),"toggle expanded/collapsed thread"]}),keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(x,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(x,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"c"})]})},{action:"Send post",keys:e(x,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:e(x,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:o,className:a,keys:i})=>e("tr",{children:[e("th",{class:a,children:o}),e("td",{children:i})]},o))})})]})})});function Xs({onClose:t}){const{masto:n}=B(),s=se.local.getJSON("accounts"),o=se.session.get("currentAccount"),a=s.length>1,[i,h]=Mt(c=>c+1,0),[l]=jt();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:l,children:s.map((c,d)=>{const u=c.info.id===o,r=d===0;return e("li",{children:[e("div",{children:[a&&e("span",{class:`current ${u?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(st,{url:c.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(u)try{const p=await n.v1.accounts.$select(c.info.id).fetch();c.info=p,se.local.setJSON("accounts",s),h()}catch{}}}),e($t,{account:a?{...c.info,acct:/@/.test(c.info.acct)?c.info.acct:`${c.info.acct}@${c.instanceURL}`}:c.info,showAcct:!0,onClick:()=>{u?S.showAccount=`${c.info.username}@${c.instanceURL}`:(se.session.set("currentAccount",c.info.id),location.reload())}})]}),e("div",{class:"actions",children:[r&&a&&e(x,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(He,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(ae,{onClick:()=>{S.showAccount=`${c.info.username}@${c.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(De,{}),a&&e(ae,{disabled:r,onClick:()=>{s.splice(d,1),s.unshift(c),se.local.setJSON("accounts",s),h()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(je,{subMenu:!0,confirmLabel:e(x,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",c.info.acct,"?"]})]}),disabled:!u,menuItemClassName:"danger",onClick:()=>{s.splice(d,1),se.local.setJSON("accounts",s),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},c.info.id)})}),e("p",{children:e(J,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),a&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const Wt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e";function hn(t){const{masto:n}=B();return n.v1.push.subscription.create(t)}function Qs(){const{masto:t}=B();return t.v1.push.subscription.fetch()}function ei(t){const{masto:n}=B();return n.v1.push.subscription.update(t)}function ti(){const{masto:t}=B();return t.v1.push.subscription.remove()}function Rt(){return"serviceWorker"in navigator&&"PushManager"in window}function ni(){return navigator.serviceWorker.getRegistration()}async function Kt(){const t=await ni(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Xn(t){const n="=".repeat((4-t.length%4)%4),s=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(s),a=new Uint8Array(o.length);for(let i=0;i<o.length;++i)a[i]=o.charCodeAt(i);return a}async function si(){if(!Rt())return;const{subscription:t}=await Kt();let n=null;try{n=await Qs()}catch(s){if(!/(not found|unknown)/i.test(s.message))throw s}if(n&&t){const s=n.endpoint===t.endpoint,{vapidKey:o}=rt(),a=n.serverKey===o;if(!s)throw new Error("Backend subscription endpoint changed");if(!a)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:s}=rt(),{applicationServerKey:o}=t.options,a=Xn(s).toString(),i=new Uint8Array(o).toString();if(!(a===i))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function fn({data:t,policy:n}){if(!Rt())return;let{registration:s,subscription:o}=await Kt(),a=null;if(o)try{a=await ei({data:t,policy:n})}catch{a=await hn({subscription:o,data:t,policy:n})}else{const{vapidKey:i}=rt();if(!i)throw new Error("No server key found");o=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Xn(i)}),a=await hn({subscription:o,data:t,policy:n})}return{subscription:o,backendSubscription:a}}async function pn(){if(!Rt())return;const{subscription:t}=await Kt();t&&(await ti(),await t.unsubscribe())}var ii={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const mn=16,nt=[14,15,16,17,18,19,20],{PHANPY_WEBSITE:gn,PHANPY_PRIVACY_POLICY_URL:oi,PHANPY_IMG_ALT_API_URL:ai}=ii;function ci({onClose:t}){const n=me(S),s=se.local.get("theme")||"auto",o=U(),a=n.settings.contentTranslationTargetLanguage||null,i=Un(),h=vs(i),l=se.local.get("textSize")||mn,[c,d]=C(se.account.get("preferences")||{}),{masto:u,authenticated:r,instance:p}=B();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:o,onInput:f=>{f.preventDefault();const m=new FormData(o.current).get("theme"),I=document.documentElement;if(m==="auto"){I.classList.remove("is-light","is-dark");const b=document.querySelector('meta[data-theme-setting="manual"]');b&&(b.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(k=>{k.name="theme-color"})}else{I.classList.toggle("is-light",m==="light"),I.classList.toggle("is-dark",m==="dark");const b=document.querySelector('meta[data-theme-setting="manual"]');b&&(b.name="theme-color",b.content=m==="light"?b.dataset.themeLightColor:b.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(k=>{k.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",m==="auto"?"dark light":m),m==="auto"?se.local.del("theme"):se.local.set("theme",m)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:s==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:s==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:s!=="light"&&s!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:nt[0]},children:"A"})," ",e("input",{type:"range",min:nt[0],max:nt[nt.length-1],step:"1",value:l,list:"sizes",onChange:f=>{const g=parseInt(f.target.value,10);document.documentElement.style.setProperty("--text-size",`${g}px`),g===mn?se.local.del("textSize"):se.local.set("textSize",f.target.value)}})," ",e("span",{style:{fontSize:nt[nt.length-1]},children:"A"}),e("datalist",{id:"sizes",children:nt.map(f=>e("option",{value:f}))})]})]})]})}),r&&e(x,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:c["posting:default:visibility"]||"public",onChange:f=>{const{value:g}=f.target;(async()=>{try{await u.v1.accounts.updateCredentials({source:{privacy:g}}),d({...c,"posting:default:visibility":g}),se.account.set("preferences",{...c,"posting:default:visibility":g})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${p}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",p,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:f=>{S.settings.autoRefresh=f.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:f=>{S.settings.boostsCarousel=f.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:f=>{const{checked:g}=f.target;S.settings.contentTranslation=g,g||(S.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:a||"",disabled:!n.settings.contentTranslation,onChange:f=>{S.settings.contentTranslationTargetLanguage=f.target.value||null},children:[e("option",{value:"",children:["System language (",h,")"]}),e("option",{disabled:!0,children:"──────────"}),sn.map(f=>e("option",{value:f.code,children:f.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(x,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:sn.map(f=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(f.code),onChange:g=>{const{checked:m}=g.target;m?S.settings.contentTranslationHideLanguages.push(f.code):S.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(I=>I!==f.code)}})," ",f.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses external translation services, powered by"," ",e("a",{href:"https://github.com/cheeaun/lingva-api",target:"_blank",rel:"noopener noreferrer",children:"Lingva API"})," ","&"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:f=>{S.settings.contentTranslationAutoInline=f.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),!!ai&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.mediaAltGenerator,onChange:f=>{S.settings.mediaAltGenerator=f.target.checked}})," ","Image description generator"," ",e(w,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Only for new images while composing new posts."})}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external AI service, powered by"," ",e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener noreferrer",children:"img-alt-api"}),". May not work well. Only for images and in English."]})})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:f=>{S.settings.cloakMode=f.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),r&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{S.showDrafts=!0,S.showSettings=!1},children:"Unsent drafts"})})]})}),r&&e(ri,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:Wt,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:f=>{f.preventDefault(),S.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:f=>{f.preventDefault(),S.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:oi,target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[gn&&e(x,{children:[e("span",{class:"insignificant",children:"Site:"})," ",gn.replace(/https?:\/\//g,"").replace(/\/$/,""),e("br",{})]}),e("span",{class:"insignificant",children:"Version:"})," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2024-02-25T12:33:02.277Z".slice(0,10).replace(/-/g,".")}.77818d3`,onClick:f=>{f.target.select();try{navigator.clipboard.writeText(f.target.value),fe("Version string copied")}catch{fe("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/77818d3",target:"_blank",rel:"noopener noreferrer",children:e(Lt,{datetime:new Date("2024-02-25T12:33:02.277Z")})}),")"]})]})]})]})]})}function ri({onClose:t}){if(!Rt())return null;const{instance:n}=B(),[s,o]=C("default"),a=U(),[i,h]=C(!1),[l,c]=C(!1),d=U();H(()=>{(async()=>{o("loading");try{const{subscription:r,backendSubscription:p}=await si();if(p!=null&&p.policy&&p.policy!=="none"){h(!0);const{alerts:f,policy:g}=p;d.current=g;const{elements:m}=a.current,I=m.namedItem(g);I&&(I.value=g),Object.keys(f).forEach(b=>{const y=m.namedItem(b);(y==null?void 0:y.type)==="checkbox"&&(y.checked=!0)})}o("default")}catch(r){/outside.*authorized/i.test(r.message)?c(!0):alert((r==null?void 0:r.message)||r),o("error")}})()},[]);const u=s==="loading";return e("form",{ref:a,onChange:()=>{const r=Object.fromEntries(new FormData(a.current)),p=!!r["policy-allow"],f={policy:r.policy,data:{alerts:{mention:!!r.mention,favourite:!!r.favourite,reblog:!!r.reblog,follow:!!r.follow,follow_request:!!r.followRequest,poll:!!r.poll,update:!!r.update,status:!!r.status}}};let g=0;Object.keys(f.data.alerts).forEach(I=>{f.data.alerts[I]?g++:delete f.data.alerts[I]});const m=d.current!==f.policy;p&&g>0?m?pn().then(()=>{fn(f)}).catch(I=>{alert("Failed to update subscription. Please try again.")}):fn(f).catch(I=>{alert("Failed to update subscription. Please try again.")}):pn().catch(I=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:u||l,name:"policy-allow",checked:i,onChange:async r=>{const{checked:p}=r.target;if(p){const f=await Notification.requestPermission();f==="granted"?h(!0):(h(!1),f==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else h(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:u||l||!i,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(r=>e("option",{value:r.value,children:r.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!i,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(r=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:r.value})," ",r.label]})}))})})})}),l&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(J,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const zt=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const s=document.querySelectorAll("#modal-container > *");if(s!=null&&s.length){const h=s[s.length-1],l=h.querySelector('[tabindex="-1"]')||h;if(l){l.focus();return}}if(document.querySelector(".deck-backdrop"))return;const a=document.querySelectorAll(".deck-container"),i=a[a.length-1];i&&i.tabIndex===-1&&i.focus()}},100);return()=>clearTimeout(t)};function Qn(t){if(!t)return;const n=ut(),s=U(n.pathname);H(()=>{s.current&&n.pathname!==s.current&&(t==null||t())},[n.pathname,t])}function Zt({list:t,onClose:n}){const{masto:s}=B(),[o,a]=C("default"),i=!!t,h=U(),l=U(),c=U();H(()=>{i&&(h.current.value=t.title,l.current.value=t.repliesPolicy,c.current&&(c.current.checked=t.exclusive))},[i]);const d=Ss("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:i?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:u=>{u.preventDefault();const r=new FormData(u.target),p=r.get("title"),f=r.get("replies_policy"),g=r.get("exclusive")==="on";a("loading"),(async()=>{try{let m;i?m=await s.v1.lists.$select(t.id).update({title:p,replies_policy:f,exclusive:g}):m=await s.v1.lists.create({title:p,replies_policy:f,exclusive:g}),a("default"),n==null||n({state:"success",list:m})}catch{a("error"),alert(i?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:h,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:l,name:"replies_policy",required:!0,disabled:o==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),d&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:c,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:o==="loading",children:i?"Save":"Create"}),i&&e(je,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{a("loading"),(async()=>{try{await s.v1.lists.$select(t.id).remove(),a("default"),n==null||n({state:"deleted"})}catch{a("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const li=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],bn={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},yn=80,es=1e3*60*10;function di(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const ui=tt(di,{maxAge:es});async function hi(t,n){const s=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:o}=await s,a={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(i=>{i.reblog?a.boosts++:i.inReplyToId&&i.inReplyToAccountId!==i.account.id?a.replies++:a.originals++}),o.length&&(a.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),a}const fi=tt(hi,{maxAge:es});function ts({account:t,fetchAccount:n=()=>{},standalone:s,instance:o,authenticated:a}){const{masto:i}=B({instance:o}),{masto:h,instance:l}=B(),[c,d]=C("default"),u=typeof t=="string",[r,p]=C(u?null:t),f=de(()=>o===l,[o,l]);H(()=>{if(!u){p(t);return}d("loading"),(async()=>{try{const N=await n();S.accounts[`${N.id}@${o}`]=N,p(N),d("default")}catch{p(null),d("error")}})()},[u,t,n]);const{acct:g,avatar:m,avatarStatic:I,bot:b,createdAt:y,displayName:k,emojis:v,fields:T,followersCount:$,followingCount:L,group:q,id:O,lastStatusAt:E,locked:D,note:A,statusesCount:_,url:M,username:K,memorial:z,moved:ee,roles:Q}=r||{};let pe=!1,{header:ge,headerStatic:Y}=r||{};(!ge||/missing\.png$/.test(ge))&&m&&!/missing\.png$/.test(m)&&(ge=m,pe=!0,I&&!/missing\.png$/.test(I)&&(Y=I));const P=de(()=>O===se.session.get("currentAccount"),[O]);H(()=>{const N=!!(r!=null&&r.id&&(r!=null&&r.username)&&(r!=null&&r.acct)&&(r!=null&&r.avatar)&&(r!=null&&r.avatarStatic)&&(r!=null&&r.displayName)&&(r!=null&&r.url));if(P&&o&&N){const oe=se.local.getJSON("accounts");let he=!1;oe.forEach(ce=>{ce.info.id===r.id&&ce.instanceURL===o&&(ce.info=r,he=!0)}),he&&se.local.setJSON("accounts",oe)}},[P,r,o]);const W=de(()=>M?new URL(M).hostname:null,[M]),[X,re]=C([]),be=U(),ve=U([]);async function Se(N){(N||!be.current)&&(be.current=i.v1.accounts.$select(O).followers.list({limit:yn}));const oe=await be.current.next();if(P||!f)return oe;const{value:he}=oe;let ce=[];if(N){const Ne=await i.v1.accounts.familiarFollowers.fetch({id:[O]});ve.current=Ne[0].accounts,ce=[...ve.current,...he.filter(Ue=>!ve.current.some(Ce=>Ce.id===Ue.id))]}else he!=null&&he.length&&(ce=he.filter(Ne=>!ve.current.some(Ue=>Ue.id===Ne.id)));return{...oe,value:ce}}const xe=U();async function V(N){return(N||!xe.current)&&(xe.current=i.v1.accounts.$select(O).following.list({limit:yn})),await xe.current.next()}const te=s?"div":J,F=o?`/${o}/a/${O}`:`/a/${O}`,[ie,ue]=C([]),[G,le]=C(),[ke,Ae]=C("default"),Pe=!!(G!=null&&G.total),R=async N=>{try{const oe=await ui(N,h);ue(oe[0].accounts.slice(0,pi))}catch{}},j=async()=>{if(O){Ae("loading");try{const N=await fi(O,i);le(N),Ae("default")}catch{Ae("error")}}},Z=Ge(({relationship:N,currentID:oe})=>{N.following||(R(oe),!s&&_>0&&j())},[s,O,_]);return e("div",{tabIndex:"-1",class:`account-container  ${c==="loading"?"skeleton":""}`,style:{"--header-color-1":X[0],"--header-color-2":X[1],"--header-color-3":X[2],"--header-color-4":X[3]},children:[c==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:u?t:M,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),c==="loading"?e(x,{children:[e("header",{children:e(Ke,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):r&&e(x,{children:[!!ee&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:k})," has indicated that their new account is now:"]}),e(Ke,{account:ee,instance:o,onClick:N=>{N.stopPropagation(),S.showAccount=ee}})]}),!!ge&&!/missing\.png$/.test(ge)&&e("img",{src:ge,alt:"",class:`header-banner ${pe?"header-is-avatar":""}`,onError:N=>{N.target.crossOrigin?N.target.src!==Y?N.target.src=Y:(N.target.removeAttribute("crossorigin"),N.target.src=ge):N.target.src!==Y?N.target.src=Y:N.target.remove()},crossOrigin:"anonymous",onLoad:N=>{N.target.classList.add("loaded");try{const oe=document.createElement("canvas"),he=oe.getContext("2d",{willReadFrequently:!0});oe.width=N.target.width,oe.height=N.target.height,he.drawImage(N.target,0,0);const ce=10,Ue=[he.getImageData(0,0,ce,ce).data,he.getImageData(N.target.width-ce,0,ce,ce).data,he.getImageData(0,N.target.height-ce,ce,ce).data,he.getImageData(N.target.width-ce,N.target.height-ce,ce,ce).data].map(Ce=>{let Fe=0,Ve=0,Ie=0,qe=0;for(let Oe=0;Oe<Ce.length;Oe+=4)Fe+=Ce[Oe],Ve+=Ce[Oe+1],Ie+=Ce[Oe+2],qe+=Ce[Oe+3];const ot=Ce.length/4;return[Fe/ot,Ve/ot,Ie/ot,qe/ot]}).map(Ce=>{const[Fe,Ve,Ie,qe]=gi(Ce);return`rgba(${Fe}, ${Ve}, ${Ie}, ${qe})`});re(Ue)}catch{}}}),e("header",{children:e(Ke,{account:r,instance:o,avatarSize:"xxxl",external:s,internal:!s})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!z&&e("span",{class:"tag",children:"In Memoriam"}),!!b&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!q&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),Q==null?void 0:Q.map(N=>e("span",{class:"tag",children:[N.name,!!W&&e(x,{children:[" ",e("span",{class:"more-insignificant",children:W})]})]})),e("div",{class:"note",dir:"auto",onClick:Fn({instance:l}),dangerouslySetInnerHTML:{__html:Ft(A,{emojis:v})}}),e("div",{class:"account-metadata-box",children:[(T==null?void 0:T.length)>0&&e("div",{class:"profile-metadata",children:T.map(({name:N,value:oe,verifiedAt:he},ce)=>e("div",{class:`profile-field ${he?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(On,{text:N,emojis:v})," ",!!he&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:Ft(oe,{emojis:v})}})]},N+ce))}),e("div",{class:"stats",children:[e(te,{tabIndex:0,to:F,onClick:()=>{setTimeout(()=>{S.showGenericAccounts={heading:"Followers",fetchAccounts:Se,instance:o,excludeRelationshipAttrs:P?["followedBy"]:[]}},0)},children:[!!ie.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:ie.map(N=>e(st,{url:N.avatarStatic,size:"s",alt:`${N.displayName} @${N.acct}`,squircle:N==null?void 0:N.bot}))})}),e("span",{title:$,children:ze($)})," ","Followers"]}),e(te,{class:"insignificant",tabIndex:0,to:F,onClick:()=>{setTimeout(()=>{S.showGenericAccounts={heading:"Following",fetchAccounts:V,instance:o,excludeRelationshipAttrs:P?["following"]:[]}},0)},children:[e("span",{title:L,children:ze(L)})," ","Following",e("br",{})]}),e(te,{class:"insignificant",to:F,children:[e("span",{title:_,children:ze(_)})," ","Posts"]}),!!y&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:y,children:Qe(y,{hideTime:!0})})]})]})]}),!!G&&e(te,{to:F,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:Pe?e("div",{class:"posting-stats",title:`${Math.round(G.originals/G.total*100)}% original posts, ${Math.round(G.replies/G.total*100)}% replies, ${Math.round(G.boosts/G.total*100)}% boosts`,children:[e("div",{children:G.daysSinceLastPost<365?`Last ${G.total} post${G.total>1?"s":""} in the past 
                      ${G.daysSinceLastPost} day${G.daysSinceLastPost>1?"s":""}`:`
                      Last ${G.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${G.originals/G.total*100}%`,"--replies-percentage":`${(G.originals+G.replies)/G.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!G,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:ke==="loading",onClick:()=>{j()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${ke==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(mi,{info:r,instance:o,authenticated:a,onRelationshipChange:Z})})]})]})}const pi=3;function mi({info:t,instance:n,authenticated:s,onRelationshipChange:o=()=>{}}){var te;if(!t)return null;const{masto:a,instance:i,authenticated:h}=B(),l=n===i,[c,d]=C("default"),[u,r]=C(null),{id:p,acct:f,url:g,username:m,locked:I,lastStatusAt:b,note:y,fields:k,moved:v}=t,T=U(p),{following:$,showingReblogs:L,notifying:q,followedBy:O,blocking:E,blockedBy:D,muting:A,mutingNotifications:_,requested:M,domainBlocking:K,endorsed:z,note:ee}=u||{},[Q,pe]=C(null),[ge,Y]=C(!1);H(()=>{if(t){const F=se.session.get("currentAccount");let ie;(async()=>{if(l&&s)ie=p;else if(!l&&h){const G=t.acct.includes("@");try{const le=await a.v2.search.fetch({q:G?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});le.accounts.length&&(ie=le.accounts[0].id,pe(le.accounts[0]))}catch{}}if(!ie)return;if(F===ie){Y(!0);return}if(T.current=ie,v)return;d("loading");const ue=a.v1.accounts.relationships.fetch({id:[ie]});try{const G=await ue;if(d("default"),G.length){const le=G[0];r(le),o({relationship:le,currentID:ie})}}catch{d("error")}})()}},[t,s]),H(()=>{t&&ge&&ks(t)},[t,ge]);const P=c==="loading",[W,X]=C(!1),[re,be]=C(!1),[ve,Se]=C(!1),[xe,V]=C([]);return e(x,{children:[e("div",{class:"actions",children:[e("span",{children:[O?e("span",{class:"tag",children:"Follows you"}):b?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:Qe(b,{hideTime:!0})})]}):e("span",{}),A&&e("span",{class:"tag danger",children:"Muted"}),E&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!ee&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{Se(!0)},dir:"auto",children:e("span",{children:ee})}),e(He,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:P,children:e(w,{icon:"more",size:"l",alt:"More"})}),onMenuChange:F=>{$&&F.open&&(async()=>{try{const ie=await a.v1.accounts.$select(T.current).lists.list();V(ie)}catch{}})()},children:[h&&!ge&&e(x,{children:[e(ae,{onClick:()=>{S.showCompose={draftStatus:{status:`@${(Q==null?void 0:Q.acct)||f} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",m]})]}),e(ae,{onClick:()=>{X(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(ae,{onClick:()=>{Se(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:ee?"Edit private note":"Add private note"})]}),$&&e(ae,{onClick:()=>{be(!0)},children:[e(w,{icon:"list"}),xe.length?e(x,{children:[e("small",{class:"menu-grow",children:["Add/Remove from Lists",e("br",{}),e("span",{class:"more-insignificant",children:xe.map(F=>F.title).join(", ")})]}),e("small",{class:"more-insignificant",children:xe.length})]}):e("span",{children:"Add/Remove from Lists"})]}),e(De,{})]}),e(ae,{href:g,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:bi(g)})]}),e("div",{class:"menu-horizontal",children:[e(ae,{onClick:()=>{try{navigator.clipboard.writeText(g),fe("Link copied")}catch{fe("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((te=navigator==null?void 0:navigator.canShare)==null?void 0:te.call(navigator,{url:g}))&&e(ae,{onClick:()=>{try{navigator.share({url:g})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!u&&e(x,{children:[e(De,{}),A?e(ae,{onClick:()=>{d("loading"),(async()=>{try{const F=await a.v1.accounts.$select((Q==null?void 0:Q.id)||p).unmute();r(F),d("default"),fe(`Unmuted @${m}`),S.reloadGenericAccounts.id="mute",S.reloadGenericAccounts.counter++}catch{d("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",m]})]}):e(Ps,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(x,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",m,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:li.map(F=>e(ae,{onClick:()=>{d("loading"),(async()=>{try{const ie=await a.v1.accounts.$select((Q==null?void 0:Q.id)||p).mute({duration:F});r(ie),d("default"),fe(`Muted @${m} for ${bn[F]}`),S.reloadGenericAccounts.id="mute",S.reloadGenericAccounts.counter++}catch{d("error"),fe(`Unable to mute @${m}`)}})()},children:bn[F]}))})}),e(je,{subMenu:!0,confirm:!E,confirmLabel:e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{d("loading"),(async()=>{try{if(E){const F=await a.v1.accounts.$select((Q==null?void 0:Q.id)||p).unblock();r(F),d("default"),fe(`Unblocked @${m}`)}else{const F=await a.v1.accounts.$select((Q==null?void 0:Q.id)||p).block();r(F),d("default"),fe(`Blocked @${m}`)}S.reloadGenericAccounts.id="block",S.reloadGenericAccounts.counter++}catch{d("error"),E?fe(`Unable to unblock @${m}`):fe(`Unable to block @${m}`)}})()},children:E?e(x,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",m]})]}):e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"…"]})]})})]})]}),!u&&c==="loading"&&e(we,{abrupt:!0}),!!u&&e(je,{confirm:$||M,confirmLabel:e("span",{children:M?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:P,onClick:()=>{d("loading"),(async()=>{try{let F;$||M?F=await a.v1.accounts.$select(T.current).unfollow():F=await a.v1.accounts.$select(T.current).follow(),F&&r(F),d("default")}catch(F){alert(F),d("error")}})()},children:e("button",{type:"button",class:`${$||M?"light swap":""}`,"data-swap-state":$||M?"danger":"",disabled:P,children:$?e(x,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):M?e(x,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):I?e(x,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!W&&e(ye,{class:"light",onClose:()=>{X(!1)},children:e(yi,{note:y,fields:k,onClose:()=>X(!1)})}),!!re&&e(ye,{class:"light",onClose:()=>{be(!1)},children:e(wi,{accountID:T.current,onClose:()=>be(!1)})}),!!ve&&e(ye,{class:"light",onClose:()=>{Se(!1)},children:e(vi,{account:t,note:ee,onRelationshipChange:F=>{r(F)},onClose:()=>Se(!1)})})]})}function gi([t,n,s]){const o=.2126*t+.7152*n+.0722*s;let a;return o>=220?a=1:o<=50?a=.1:a=o/255,a=Math.min(1,a),[t,n,s,a]}function bi(t){if(!t)return;const n=new URL(t),{host:s,pathname:o}=n,a=o.replace(/\/$/,"").replace(/^\//,"");return e(x,{children:[e("span",{class:"more-insignificant",children:[s,"/"]}),e("wbr",{}),e("span",{children:a})]})}function yi({note:t,fields:n,onClose:s}){const o=(n==null?void 0:n.map(({name:i,value:h})=>`${i}
${on(h)}`).join(`

`))||"",a=on(t)+(o?`

${o}`:"");return e("div",{class:"sheet",children:[!!s&&e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:a}),e(zn,{forceTranslate:!0,text:a})]})]})}function wi({accountID:t,onClose:n}){const{masto:s}=B(),[o,a]=C("default"),[i,h]=C([]),[l,c]=C([]),[d,u]=Mt(f=>f+1,0);H(()=>{a("loading"),(async()=>{try{const f=await s.v1.lists.list();f.sort((m,I)=>m.title.localeCompare(I.title));const g=await s.v1.accounts.$select(t).lists.list();h(f),c(g),a("default")}catch{a("error")}})()},[d]);const[r,p]=C(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[i.length>0?e("ul",{class:"list-add-remove",children:i.map(f=>{const g=l.some(m=>m.id===f.id);return e("li",{children:e("button",{type:"button",class:`light ${g?"checked":""}`,disabled:o==="loading",onClick:()=>{a("loading"),(async()=>{try{g?await s.v1.lists.$select(f.id).accounts.remove({accountIds:[t]}):await s.v1.lists.$select(f.id).accounts.create({accountIds:[t]}),u()}catch{a("error"),alert(g?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:f.title})]})})})}):o==="loading"?e("p",{class:"ui-state",children:e(we,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>p(!0),disabled:o!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),r&&e(ye,{class:"light",onClick:f=>{f.target===f.currentTarget&&p(!1)},children:e(Zt,{list:r==null?void 0:r.list,onClose:f=>{f.state==="success"&&u(),p(!1)}})})]})}function vi({account:t,note:n,onRelationshipChange:s=()=>{},onClose:o=()=>{}}){const{masto:a}=B(),[i,h]=C("default"),l=U(null);return H(()=>{let c;return l.current&&!n&&(c=setTimeout(()=>{var d,u;(u=(d=l.current).focus)==null||u.call(d)},100)),()=>{clearTimeout(c)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:c=>{c.preventDefault();const u=new FormData(c.target).get("note");(u==null?void 0:u.trim())!==(n==null?void 0:n.trim())&&(h("loading"),(async()=>{try{const r=await a.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:u});h("default"),s(r),o()}catch(r){h("error"),alert((r==null?void 0:r.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:l,name:"note",disabled:i==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:i==="loading",onClick:()=>{o==null||o()},children:"Cancel"}),e("span",{children:[e(we,{abrupt:!0,hidden:i!=="loading"}),e("button",{disabled:i==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function Si({account:t,instance:n,onClose:s}){const{masto:o,instance:a,authenticated:i}=B({instance:n}),h=typeof t=="string";return H(()=>{h||(S.accounts[`${t.id}@${a}`]=t)},[t]),Qn(s),e("div",{class:"sheet",children:[!!s&&e("button",{type:"button",class:"sheet-close outer",onClick:s,children:e(w,{icon:"x"})}),e(ts,{instance:a,authenticated:i,account:t,fetchAccount:async()=>{if(h)try{return await o.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const c=await o.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:i});if(c.accounts.length)return c.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const d=new URL(t),{hostname:u,pathname:r}=d,p=r.replace(/^\//,"").replace(/\/$/,"")+"@"+u,f=await o.v2.search.fetch({q:p,type:"accounts",limit:1,resolve:i});if(f.accounts.length)return f.accounts[0]}}else return t}})]})}function ki({onClose:t}){const{masto:n}=B(),[s,o]=C("default"),[a,i]=C([]),[h,l]=Mt(d=>d+1,0);H(()=>{o("loading"),(async()=>{try{const d=await pt.drafts.keys();if(d.length){const u=Bn(),r=d.filter(p=>p.startsWith(u));if(r.length){const p=await pt.drafts.getMany(r);p.sort((f,g)=>new Date(g.updatedAt).getTime()-new Date(f.updatedAt).getTime()),i(p)}else i([])}else i([]);o("default")}catch{o("error")}})()},[h]);const c=(a==null?void 0:a.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(we,{abrupt:!0,hidden:s!=="loading"})]}),c&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:c?e(x,{children:[e("ul",{class:"drafts-list",children:a.map(d=>{const{updatedAt:u,key:r,draftStatus:p,replyTo:f}=d,g=new Date(u);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:f?"reply":"quill",size:"s"})," ",e("time",{children:[!!f&&e(x,{children:["@",f.account.acct,e("br",{})]}),Qe(g)]})]}),e(je,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:s==="loading",onClick:()=>{(async()=>{try{await pt.drafts.del(r),l()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:s==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:s==="loading",class:"draft-item",onClick:async()=>{let m;if(f){o("loading");try{m=await n.v1.statuses.$select(f.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:p,replyToStatus:m},S.showCompose=!0,S.showDrafts=!1},children:e(Ii,{draft:d})})]},u)})}),a.length>1&&e("p",{children:e(je,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:s==="loading",onClick:()=>{(async()=>{o("loading");try{await pt.drafts.delMany(a.map(d=>d.key)),o("default"),l()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:s==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function Ii({draft:t}){var r;const{draftStatus:n,replyTo:s}=t,{status:o,spoilerText:a,poll:i,mediaAttachments:h}=n,l=((r=i==null?void 0:i.options)==null?void 0:r.length)>0,c=(h==null?void 0:h.length)>0,d=l||c,u=de(()=>{if(!c)return;const p=h.find(m=>/image/.test(m.type));if(!p)return;const{file:f}=p;return URL.createObjectURL(f)},[c,h]);return e(x,{children:e("div",{class:"mini-draft",children:[d&&e("div",{class:`mini-draft-aside ${u?"has-image":""}`,style:u?{"--bg-image":`url(${u})`}:{},children:[l&&e(w,{icon:"poll"}),c&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:h==null?void 0:h.length})]})]}),e("div",{class:"mini-draft-main",children:[!!a&&e("div",{class:"mini-draft-spoiler",children:a}),!!o&&e("div",{class:"mini-draft-status",children:o})]})]})})}function Ti({html:t,url:n,width:s,height:o,onClose:a=()=>{}}){return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>a(),children:e(w,{icon:"x"})}),n&&e("a",{href:n,target:"_blank",rel:"noopener noreferrer",class:"button plain",children:[e("span",{children:"Open link"})," ",e(w,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:t},style:{"--width":s+"px","--height":o+"px","--aspect-ratio":`${s}/${o}`}})]})}async function Jt(t,n={}){if(!(t!=null&&t.length))return;const{masto:s}=B(),o=se.session.get("currentAccount"),a=t.reduce((i,h)=>(!i.includes(h.id)&&!n[h.id]&&h.id!==o&&i.push(h.id),i),[]);if(!a.length)return null;try{return(await s.v1.accounts.relationships.fetch({id:a})).reduce((l,c)=>(l[c.id]=c,l),{})}catch{return null}}function Ci({instance:t,excludeRelationshipAttrs:n=[],onClose:s=()=>{}}){const{masto:o,instance:a}=B(),i=t?t===a:!0,h=me(S),[l,c]=C("default"),[d,u]=C([]),[r,p]=C(!1);if(Qn(s),!h.showGenericAccounts)return null;const{id:f,heading:g,fetchAccounts:m,accounts:I,showReactions:b}=h.showGenericAccounts,[y,k]=C({}),v=async L=>{if(!(L!=null&&L.length)||!i)return;const q=await Jt(L,y);q&&k({...y,...q})},T=L=>{m&&(L&&u([]),c("loading"),(async()=>{try{const{done:q,value:O}=await m(L);if(Array.isArray(O)){if(L){const E=[];for(let D=0;D<O.length;D++){const A=O[D],_=E.find((M,K)=>M.id===A.id&&D!==K);_?_._types.push(...A._types):E.push({_types:[],...A})}u(E)}else u(E=>{const D=E;for(const A of O){const _=D.find(M=>M.id===A.id);_?_._types.push(...A._types):D.push(A)}return D});p(!q),v(O)}else p(!1);c("default")}catch{c("error")}})())},$=U(!0);return H(()=>{(I==null?void 0:I.length)>0?(u(I),v(I)):(T(!0),$.current=!1)},[I,m]),H(()=>{var L;$.current||((L=h.reloadGenericAccounts)==null?void 0:L.id)===f&&T(!0)},[h.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:g||"Accounts"})}),e("main",{children:d.length>0?e(x,{children:[e("ul",{class:"accounts-list",children:d.map(L=>{var E,D;const q=y[L.id],O=`${L.id}-${((E=L._types)==null?void 0:E.length)||""}`;return e("li",{children:[b&&((D=L._types)==null?void 0:D.length)>0&&e("div",{class:"reactions-block",children:L._types.map(A=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[A],class:`${A}-icon`}))}),e("div",{class:"account-relationships",children:e(Ke,{account:L,showStats:!0,relationship:q,excludeRelationshipAttrs:n})})]},O)})}),l==="default"?r?e(Ze,{onChange:L=>{L&&T()},children:e("button",{type:"button",class:"plain block",onClick:()=>T(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):l==="loading"&&e("p",{class:"ui-state",children:e(we,{abrupt:!0})})]}):l==="loading"?e("p",{class:"ui-state",children:e(we,{abrupt:!0})}):l==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function $i({alt:t,lang:n,onClose:s}){const o=me(S),[a,i]=C(!1),h=Un(!0),l=o.settings.contentTranslationHideLanguages||[],c=!!n&&n!==h&&!an([n],[h])&&!l.find(d=>n===d||an([n],[d]));return e("div",{class:"sheet",tabindex:"-1",children:[!!s&&e("button",{type:"button",class:"sheet-close outer",onClick:s,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(He,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:[e(ae,{disabled:a,onClick:()=>{i(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]}),Is&&e(ae,{onClick:()=>{Ts(t,n)},children:[e(w,{icon:"speak"}),e("span",{children:"Speak"})]})]})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(c||a)&&e(zn,{forceTranslate:a,sourceLanguage:n,text:t})]})]})}function Et(t,n,s){return Math.max(Math.min(t,s),n)}const Pt=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Dt=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function ns([t,n,s]){t=Pt(t/255),n=Pt(n/255),s=Pt(s/255);var o=.4122214708*t+.5363325363*n+.0514459929*s,a=.2119034982*t+.6806995451*n+.1073969566*s,i=.0883024619*t+.2817188376*n+.6299787005*s;return o=Math.cbrt(o),a=Math.cbrt(a),i=Math.cbrt(i),[o*.2104542553+a*.793617785+i*-.0040720468,o*1.9779984951+a*-2.428592205+i*.4505937099,o*.0259040371+a*.7827717662+i*-.808675766]}function ss([t,n,c]){var o=t+n*.3963377774+c*.2158037573,a=t+n*-.1055613458+c*-.0638541728,i=t+n*-.0894841775+c*-1.291485548;o=o**3,a=a**3,i=i**3;var h=o*4.0767416621+a*-3.3077115913+i*.2309699292,l=o*-1.2684380046+a*2.6097574011+i*-.3413193965,c=o*-.0041960863+a*-.7034186147+i*1.707614701;return h=255*Dt(h),l=255*Dt(l),c=255*Dt(c),h=Et(h,0,255),l=Et(l,0,255),c=Et(c,0,255),h=Math.round(h),l=Math.round(l),c=Math.round(c),[h,l,c]}var xi={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:Ma}=xi;function is({mediaAttachments:t,statusID:n,instance:s,lang:o,index:a=0,onClose:i=()=>{}}){var y,k;const[h,l]=C("default"),c=U(null),[d,u]=C(a),r=U(null);Je(()=>{var v;(v=r.current)==null||v.scrollIntoView()},[]);const p=U(n);H(()=>{const v=a*c.current.clientWidth,T=p.current!==n;T&&(p.current=n),c.current.scrollTo({left:v,behavior:T?"auto":"smooth"}),c.current.focus()},[a,n]);const[f,g]=C(!0);H(()=>{let v=()=>{i()};return c.current&&c.current.addEventListener("swiped-down",v),()=>{c.current&&c.current.removeEventListener("swiped-down",v)}},[]),Me("esc",i,{ignoreEventWhen:v=>!!document.querySelector("#modal-container > *")},[i]),H(()=>{let v=()=>{const{clientWidth:T,scrollLeft:$}=c.current,L=Math.round($/T);u(L)};return c.current&&c.current.addEventListener("scroll",v,{passive:!0}),()=>{c.current&&c.current.removeEventListener("scroll",v)}},[]),H(()=>{let v=setTimeout(()=>{var T,$;($=(T=c.current)==null?void 0:T.focus)==null||$.call(T)},100);return()=>clearTimeout(v)},[]);const m=de(()=>t==null?void 0:t.map(v=>{const{blurhash:T}=v;if(T){const $=jn(T),L=ns($);return ss([.6,L[1],L[2]])}return null}),[t]),I=de(()=>{var $;const T=100/m.length;return(($=m==null?void 0:m.map((L,q)=>{const O=q*T+5,E=(q+1)*T-5;return L?`
            rgba(${L==null?void 0:L.join(",")}, 0.4) ${O}%,
            rgba(${L==null?void 0:L.join(",")}, 0.4) ${E}%
          `:`
            transparent ${O}%,
            transparent ${E}%
          `}))==null?void 0:$.join(", "))||"transparent"},[m]);let b=U(null);return H(()=>()=>{var v,T;(T=(v=b.current)==null?void 0:v.hideToast)==null||T.call(v)},[]),e("div",{class:`media-modal-container media-modal-count-${t==null?void 0:t.length}`,children:[e("div",{ref:c,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:v=>{(v.target.classList.contains("carousel-item")||v.target.classList.contains("media")||v.target.classList.contains("media-zoom"))&&i()},style:t.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${I})`}:{},children:t==null?void 0:t.map((v,T)=>{const $=t.length===1?m[T]:null;return e("div",{class:"carousel-item",style:$?{"--accent-color":`rgb(${$==null?void 0:$.join(",")})`,"--accent-alpha-color":`rgba(${$==null?void 0:$.join(",")}, 0.4)`}:{},tabindex:"0",ref:T===d?r:null,onClick:L=>{L.target.classList.contains("media")||g(!f)},children:[!!v.description&&e("button",{type:"button",class:"media-alt",hidden:!f,onClick:()=>{S.showMediaAlt={alt:v.description,lang:o}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:o,dir:"auto",children:v.description})]}),e(qn,{media:v,showOriginal:!0,lang:o})]},v.id)})}),e("div",{class:"carousel-top-controls",hidden:!f,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>i(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((v,T)=>e("button",{type:"button",disabled:T===d,class:`carousel-dot ${T===d?"active":""}`,onClick:$=>{$.preventDefault(),$.stopPropagation(),c.current.scrollTo({left:c.current.clientWidth*T,behavior:"smooth"}),c.current.focus()},children:e(w,{icon:"round",size:"s"})},v.id))}):e("span",{}),e("span",{children:[e(He,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:[e(Ee,{href:((y=t[d])==null?void 0:y.remoteUrl)||((k=t[d])==null?void 0:k.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]}),!1]})," ",e(J,{to:`${s?`/${s}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${d+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!f,children:[e("button",{type:"button",class:"carousel-button",hidden:d===0,onClick:v=>{v.preventDefault(),v.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(d-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:d===t.length-1,onClick:v=>{v.preventDefault(),v.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(d+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const Ai="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",Li="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",Mi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",Ri=200,_i=10;async function xt(){const{masto:t}=B(),n=t.v1.followedTags.list({limit:Ri}),s=[];let o=0;do{const{value:a,done:i}=await n.next();if(i||(a==null?void 0:a.length)===0)break;s.push(...a),o++}while(o<_i);return s.sort((a,i)=>a.name.localeCompare(i.name)),s.length&&setTimeout(()=>{se.account.set("followedTags",{tags:s,updatedAt:Date.now()})},1),s}const Ei=24*60*60*1e3;async function Pi(){try{const{tags:t,updatedAt:n}=se.account.get("followedTags")||{};return t!=null&&t.length?(Date.now()-n>Ei&&xt(),t):await xt()}catch{return[]}}const wn=document.createElement("div"),Di=t=>{if(!t)return[];if(t.indexOf("#")===-1)return[];wn.innerHTML=t;const n=wn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(s=>s.innerText.trim().replace(/^[^#]*#+/,"")):[]};function Bt({children:t}){if(typeof t=="string")return t;const[n,s]=C("");return H(()=>{Promise.resolve(t).then(s)},[t]),n}const et=9,Ni=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],os={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},kt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},Ui=tt(async({id:t})=>(await B().masto.v1.lists.$select(t).fetch()).title),Fi=tt(async({id:t})=>{const n=await B().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),At={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Ui,path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||B().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||B().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t?`“${t}”`:"Search",path:({query:t})=>t?`/search?q=${encodeURIComponent(t)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:t})=>t?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:Fi,path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||B().instance,path:({hashtag:t,instance:n,media:s})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${s?"?media=1":""}`,icon:"hashtag"}};function Oi({onClose:t}){const n=me(S),{shortcuts:s}=n,[o,a]=C(!1),[i,h]=C(!1),[l]=jt();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Ai},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Mi},{value:"multi-column",label:"Multi-column",imgURL:Li}].map(({value:c,label:d,imgURL:u})=>{const r=n.settings.shortcutsViewMode===c||c==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:r?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:c,checked:r,onChange:p=>{S.settings.shortcutsViewMode=p.target.value}})," ",e("img",{src:u,alt:"",width:"80",height:"58"})," ",e("span",{children:d})]},c)})}),s.length>0?e(x,{children:[e("ol",{class:"shortcuts-list",ref:l,children:s.filter(Boolean).map((c,d)=>{const u=Object.values(c).join("-"),{type:r}=c;if(!At[r])return null;let{icon:p,title:f,subtitle:g,excludeViewMode:m}=At[r];typeof f=="function"&&(f=f(c,d)),typeof g=="function"&&(g=g(c,d)),typeof p=="function"&&(p=p(c,d)),typeof m=="function"&&(m=m(c,d));const I=m==null?void 0:m.includes(n.settings.shortcutsViewMode);return e("li",{children:[e(w,{icon:p}),e("span",{class:"shortcut-text",children:[e(Bt,{children:f}),g&&e(x,{children:[" ",e("small",{class:"ib insignificant",children:g})]}),I&&e("span",{class:"tag",children:"Not available in current view mode"})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:d===0,onClick:()=>{const b=Array.from(S.shortcuts);if(d>0){const y=S.shortcuts[d-1];b[d-1]=c,b[d]=y,S.shortcuts=b}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:d===s.length-1,onClick:()=>{const b=Array.from(S.shortcuts);if(d<S.shortcuts.length-1){const y=S.shortcuts[d+1];b[d+1]=c,b[d]=y,S.shortcuts=b}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{a({shortcut:c,shortcutIndex:d})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},u)})}),s.length===1&&n.settings.shortcutsViewMode!=="float-button"&&e("div",{class:"ui-state insignificant",children:[e(w,{icon:"info"})," ",e("small",{children:"Add more than one shortcut/column to make this work."})]})]}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:c=>{c.preventDefault(),S.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:s.length>=et&&`Max ${et} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>h(!0),children:"Import/export"}),e("button",{type:"button",disabled:s.length>=et,onClick:()=>a(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),o&&e(ye,{class:"light",onClick:c=>{c.target===c.currentTarget&&a(!1)},children:e(qi,{shortcut:o.shortcut,shortcutIndex:o.shortcutIndex,onSubmit:({result:c,mode:d})=>{d==="edit"?S.shortcuts[o.shortcutIndex]=c:S.shortcuts.push(c)},onClose:()=>a(!1)})}),i&&e(ye,{class:"light",onClick:c=>{c.target===c.currentTarget&&h(!1)},children:e(Hi,{shortcuts:s,onClose:()=>h(!1)})})]})}const zi=1e3*60,Bi=tt(()=>{const{masto:t}=B();return t.v1.lists.list()},{maxAge:zi}),vn={search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function qi({onSubmit:t,disabled:n,shortcut:s,shortcutIndex:o,onClose:a}){var I,b;const i=!!s,[h,l]=C((s==null?void 0:s.type)||null),{masto:c}=B(),[d,u]=C("default"),[r,p]=C([]),[f,g]=C([]);H(()=>{(async()=>{if(h==="list")try{u("loading");const y=await Bi();y.sort((k,v)=>k.title.localeCompare(v.title)),p(y),u("default")}catch{u("error")}})(),(async()=>{if(h==="hashtag")try{const y=await xt();g(y)}catch{}})()},[h]);const m=U();return H(()=>{if(i&&h&&kt[h]){const y=m.current;kt[h].forEach(({name:k,type:v})=>{const T=y.querySelector(`[name="${k}"]`);T&&s[k]&&(v==="checkbox"?T.checked=s[k]==="on":T.value=s[k])})}},[i,h]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[i?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:m,onSubmit:y=>{y.preventDefault();const k=new FormData(y.target),v={};k.forEach((T,$)=>{v[$]=T==null?void 0:T.trim(),$==="instance"&&(v[$]=v[$].replace(/^https?:\/\//,"").replace(/\/+$/,""),v[$]=v[$].replace(/^@?[^@]+@/,""))}),v.type&&(t({result:v,mode:i?"edit":"add"}),y.target.reset(),l(null),a==null||a())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:n,onChange:y=>{l(y.target.value)},defaultValue:i?s.type:void 0,name:"type",children:[e("option",{}),Ni.map(y=>e("option",{value:y,children:os[y]}))]})]})}),(b=(I=kt[h])==null?void 0:I.map)==null?void 0:b.call(I,({text:y,name:k,type:v,placeholder:T,pattern:$,notRequired:L})=>h==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!L,disabled:n||d==="loading",defaultValue:i?s.id:void 0,children:r.map(q=>e("option",{value:q.id,children:q.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:y})," ",e("input",{type:v,switch:v==="checkbox"||void 0,name:k,placeholder:T,required:v==="text"&&!L,disabled:n,list:h==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:$}),h==="hashtag"&&f.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:f.map(q=>e("option",{value:q.name}))})]})})),!!vn[h]&&e("p",{class:"form-note insignificant",children:[e(w,{icon:"info"}),vn[h]]}),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:n||d==="loading",children:i?"Save":"Add"}),i&&e("button",{type:"button",class:"light danger",onClick:()=>{S.shortcuts.splice(o,1),a==null||a()},children:"Remove"})]})]})})]})}function Hi({shortcuts:t,onClose:n}){var d;const s=de(()=>!t||!t.filter(Boolean).length?"":dn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,a]=C(""),[i,h]=C("default"),l=de(()=>{if(!o)return h("default"),null;try{const u=JSON.parse(dn.decompressFromEncodedURIComponent(o));if(!Array.isArray(u))throw new Error("Not an array");return h("default"),u}catch{try{const r=JSON.parse(o);if(!Array.isArray(r))throw new Error("Not an array");return h("default"),r}catch{return h("error"),null}}},[o]),c=S.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:u=>{a(u.target.value)}})}),!!l&&Array.isArray(l)&&e(x,{children:[e("p",{children:[e("b",{children:l.length})," shortcut",l.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:l.map(u=>{var r,p;return e("li",{children:[e("span",{style:{opacity:t.some(f=>Object.keys(f).every(g=>f[g]===u[g]))?1:0},children:"*"}),e("span",{children:[os[u.type],u.type==="list"&&" ⚠️"," ",(p=(r=kt[u.type])==null?void 0:r.map)==null?void 0:p.call(r,({text:f,name:g,type:m})=>u[g]?e(x,{children:[e("span",{class:"tag collapsed insignificant",children:[f,":"," ",m==="checkbox"?u[g]==="on"?"✅":"❌":u[g]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),i==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[c&&e(x,{children:[e(je,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const u=l.filter(f=>!S.shortcuts.some(g=>Object.keys(g).every(m=>g[m]===f[m])));if(!u.length){fe("No new shortcuts to import");return}let r=[...S.shortcuts,...u];const p=r.length>et;p&&(r=r.slice(0,et)),S.shortcuts=r,fe(p?`Shortcuts imported. Exceeded max ${et}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!l,children:"Import & append…"})})," "]}),e(je,{confirmLabel:c?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:c?"danger":void 0,onClick:()=>{S.shortcuts=l,fe("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!l,children:c?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:s,readOnly:!0,onClick:u=>{if(u.target.value){u.target.select();try{navigator.clipboard.writeText(u.target.value),fe("Shortcuts copied")}catch{fe("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.clipboard.writeText(s),fe("Shortcut settings copied")}catch{fe("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:s}))&&e("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.share({text:s})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",s.length>0&&e("small",{class:"insignificant",children:[s.length," characters"]})]}),!!s&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}Yn(S,t=>{for(const[n,s,o,a]of t)/^show/i.test(s)&&!o&&zt()});function Vi(){var o,a,i,h,l,c,d,u;const t=me(S),n=Wn(),s=ut();return e(x,{children:[!!t.showCompose&&e(ye,{children:e(Cs,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((a=S.showCompose)==null?void 0:a.editStatus)||((i=window.__COMPOSE__)==null?void 0:i.editStatus)||null,draftStatus:((h=S.showCompose)==null?void 0:h.draftStatus)||((l=window.__COMPOSE__)==null?void 0:l.draftStatus)||null,onClose:r=>{const{newStatus:p,instance:f,type:g}=r||{};S.showCompose=!1,window.__COMPOSE__=null,p&&(S.reloadStatusPage++,fe({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[g||"post"],delay:1e3,duration:1e4,onClick:m=>{m.hideToast(),S.prevLocation=s,n(f?`/${f}/s/${p.id}`:`/s/${p.id}`)}}))}})}),!!t.showSettings&&e(ye,{onClose:()=>{S.showSettings=!1},children:e(ci,{onClose:()=>{S.showSettings=!1}})}),!!t.showAccounts&&e(ye,{onClose:()=>{S.showAccounts=!1},children:e(Xs,{onClose:()=>{S.showAccounts=!1}})}),!!t.showAccount&&e(ye,{class:"light",onClose:()=>{S.showAccount=!1},children:e(Si,{account:((c=t.showAccount)==null?void 0:c.account)||t.showAccount,instance:(d=t.showAccount)==null?void 0:d.instance,onClose:({destination:r}={})=>{S.showAccount=!1}})}),!!t.showDrafts&&e(ye,{onClose:()=>{S.showDrafts=!1},children:e(ki,{onClose:()=>S.showDrafts=!1})}),!!t.showMediaModal&&e(ye,{onClick:r=>{(r.target===r.currentTarget||r.target.classList.contains("media"))&&(S.showMediaModal=!1)},children:e(is,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{S.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(ye,{class:"light",onClose:()=>{S.showShortcutsSettings=!1},children:e(Oi,{onClose:()=>S.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(ye,{class:"light",onClose:()=>{S.showGenericAccounts=!1},children:e(Ci,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,onClose:()=>S.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(ye,{class:"light",onClose:r=>{S.showMediaAlt=!1},children:e($i,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(u=t.showMediaAlt)==null?void 0:u.lang,onClose:()=>{S.showMediaAlt=!1}})}),!!t.showEmbedModal&&e(ye,{onClose:()=>{S.showEmbedModal=!1},children:e(Ti,{html:t.showEmbedModal.html,url:t.showEmbedModal.url,width:t.showEmbedModal.width,height:t.showEmbedModal.height,onClose:()=>{S.showEmbedModal=!1}})})]})}function qt({accountID:t,onChange:n}){const{masto:s}=B(),[o,a]=C("default"),[i,h]=C(null),[l,c]=C(null),d=l!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:o==="loading"||d,onClick:()=>{a("loading"),h("accept"),(async()=>{try{const u=await s.v1.followRequests.$select(t).authorize();if(!(u!=null&&u.followedBy))throw new Error("Follow request not accepted");c(u),n()}catch{}a("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:o==="loading"||d,class:"light danger",onClick:()=>{a("loading"),h("reject"),(async()=>{try{const u=await s.v1.followRequests.$select(t).reject();if(u!=null&&u.followedBy)throw new Error("Follow request not rejected");c(u),n()}catch{a("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:d&&i?i==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(we,{hidden:o!=="loading"})})]})}const Sn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},at={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(x,{children:["reported ",t]})},Nt=50;function Gi({notification:t,instance:n,isStatic:s,disableContextMenu:o}){var L,q,O,E;const{id:a,status:i,account:h,report:l,_accounts:c,_statuses:d}=t;let{type:u}=t;const r=(i==null?void 0:i.reblog)||i,p=r==null?void 0:r.id,f=se.session.get("currentAccount"),g=f===(h==null?void 0:h.id),m=(L=i==null?void 0:i.poll)==null?void 0:L.voted,I=!!(i!=null&&i.inReplyToAccountId)&&(i==null?void 0:i.inReplyToAccountId)!==f&&((q=i==null?void 0:i.account)==null?void 0:q.id)===f;let b=0,y=0;if(u==="favourite+reblog"){for(const D of c)(O=D._types)!=null&&O.includes("favourite")&&b++,(E=D._types)!=null&&E.includes("reblog")&&y++;!y&&b&&(u="favourite"),!b&&y&&(u="reblog")}let k;if(u==="poll"?k=at[g?"poll-self":m?"poll-voted":"poll"]:u==="reblog"||u==="favourite"||u==="favourite+reblog"?(d==null?void 0:d.length)>1?k=at[`${u}+account`]:I?k=at[`${u}_reply`]:k=at[u]:at[u]?k=at[u]:k=`[Unknown notification type: ${u}]`,typeof k=="function"){const D=(d==null?void 0:d.length)||(c==null?void 0:c.length);if(D)k=k(D);else if(u==="admin.report"){const A=l==null?void 0:l.targetAccount;A&&(k=k(e($t,{account:A,showAvatar:!0})))}}if(u==="mention"&&!i)return null;const v=t.createdAt&&new Date(t.createdAt).toLocaleString(),T={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[u]||"Accounts",$=()=>{S.showGenericAccounts={heading:T,accounts:c,showReactions:u==="favourite+reblog",excludeRelationshipAttrs:u==="follow"?["followedBy"]:[]}};return e("div",{class:`notification notification-${u}`,"data-notification-id":a,tabIndex:"0",children:[e("div",{class:`notification-type notification-${u}`,title:v,children:u==="favourite+reblog"?e(x,{children:[e(w,{icon:"rocket",size:"xl",alt:u,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:u,class:"favourite-icon"})]}):e(w,{icon:Sn[u]||"notification",size:"xl",alt:u})}),e("div",{class:"notification-content",children:[u!=="mention"&&e(x,{children:[e("p",{children:[!/poll|update/i.test(u)&&e(x,{children:(c==null?void 0:c.length)>1?e(x,{children:[e("b",{tabIndex:"0",onClick:$,children:[e("span",{title:c.length,children:ze(c.length)})," ","people"]})," "]}):e(x,{children:[e($t,{account:h,showAvatar:!0})," "]})}),k,u==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(Lt,{datetime:t.createdAt,format:"micro"})]})]}),u==="follow_request"&&e(qt,{accountID:h.id})]}),(c==null?void 0:c.length)>1&&e("p",{class:"avatars-stack",children:[c.slice(0,Nt).map(D=>e(x,{children:[e("a",{href:D.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:A=>{A.preventDefault(),S.showAccount=D},children:[e(st,{url:D.avatarStatic,size:c.length<=10?"xxl":c.length<20?"xl":c.length<30?"l":c.length<40?"m":"s",alt:`${D.displayName} @${D.acct}`,squircle:D==null?void 0:D.bot},D.id),u==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:D._types.map(A=>e(w,{icon:Sn[A],size:"s",class:`${A}-icon`}))})]},D.id)," "]},D.id)),e("button",{type:"button",class:"small plain",onClick:$,children:[c.length>Nt&&`+${c.length-Nt}`,e(w,{icon:"chevron-down"})]})]}),(d==null?void 0:d.length)>1&&e("ul",{class:"notification-group-statuses",children:d.map(D=>e("li",{children:e(kn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${D.id}`:`/s/${D.id}`,children:e(Le,{status:D,size:"s",previewMode:!0,allowContextMenu:!0})})},D.id))}),i&&(!(d!=null&&d.length)||(d==null?void 0:d.length)<=1)&&e(kn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${p}`:`/s/${p}`,onContextMenu:o?void 0:D=>{const A=D.target.querySelector(".status");if(A){if(D.metaKey)return;D.preventDefault(),A.dispatchEvent(new MouseEvent("contextmenu",{clientX:D.clientX,clientY:D.clientY}))}},children:s?e(Le,{status:r,size:"s",readOnly:!0,allowContextMenu:!0}):e(Le,{statusID:p,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function kn(t){const n=$s();return e(J,{...t,"data-read-more":"Read more →",ref:n})}const Xt=Be(Gi,(t,n)=>{var s,o;return((s=t.notification)==null?void 0:s.id)===((o=n.notification)==null?void 0:o.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{const{type:n,id:s,accessToken:o}=(t==null?void 0:t.data)||{};n==="notification"&&(S.routeNotification={id:s,accessToken:o})});const ji=Be(function(){if(!("serviceWorker"in navigator))return null;const n=me(S),{routeNotification:s}=n,{id:o,accessToken:a}=s||{},[i,h]=C(!1);Je(()=>{if(!o||!a)return;const{instance:c}=B(),{masto:d,instance:u}=B({accessToken:a}),r=c===u,p=a?xs(a):rt();(async()=>{const f=await d.v1.notifications.$select(o).fetch();if(f&&p){const g=p.instanceURL,{type:m,status:I,account:b}=f,y=!!document.querySelector("#modal-container > *"),k=m==="follow"&&!!(b!=null&&b.id),v=!!(b!=null&&b.id),T=!!(I!=null&&I.id);k&&r?S.showAccount={account:b,instance:g}:y||!r||v&&T?h({id:o,account:p,notification:f,sameInstance:r}):T?location.hash=`/${c}/s/${I.id}`:k?location.hash=`/${c}/a/${b.id}`:location.hash="/notifications"}})()},[o,a]),Je(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),lt(c=>{c&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const l=()=>{h(!1),S.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(i){const{id:c,account:d,notification:u,sameInstance:r}=i;return e(ye,{class:"light",onClick:p=>{p.target===p.currentTarget&&l()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:l,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!r&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:p=>{const{target:f}=p;(p.target.tagName==="BUTTON"||p.target.tagName==="A")&&l()},children:e(Xt,{instance:d.instanceURL,notification:u,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(J,{to:"/notifications",class:"button light",onClick:l,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null}),as=Ns((t,n)=>{const{instance:s}=B(),[o,a]=We(),[i,h]=C(!1),[l,c]=C(o.get("q")||""),d=o.get("type"),u=U(null),r=U(null);return Ds(n,()=>({setValue:p=>{c(p)},focus:()=>{r.current.focus()},select:()=>{r.current.select()},blur:()=>{r.current.blur()}})),e("form",{ref:u,class:"search-popover-container",onSubmit:p=>{var g;if(p.preventDefault(),/\/search/.test(location.hash))if(l){const m={q:l};d&&(m.type=d),a(m)}else a({});else l?location.hash=`/search?q=${encodeURIComponent(l)}${d?`&type=${d}`:""}`:location.hash="/search";(g=t==null?void 0:t.onSubmit)==null||g.call(t,p)},children:[e("input",{ref:r,value:l,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",onSearch:p=>{p.target.value||a({})},onInput:p=>{c(p.target.value),h(!0)},onFocus:()=>{var p,f;h(!0),(f=(p=u.current)==null?void 0:p.querySelector(".search-popover-item"))==null||f.classList.add("focus")},onBlur:()=>{var p,f;setTimeout(()=>{h(!1)},100),(f=(p=u.current)==null?void 0:p.querySelector(".search-popover-item.focus"))==null||f.classList.remove("focus")},onKeyDown:p=>{var g;const{key:f}=p;switch(f){case"Escape":h(!1);break;case"Down":case"ArrowDown":if(p.preventDefault(),i){const m=u.current.querySelector(".search-popover-item.focus");if(m){let I=m.nextElementSibling;for(;I&&I.hidden;)I=I.nextElementSibling;I&&(I.classList.add("focus"),Array.from(I.parentElement.children).filter(y=>y!==I).forEach(y=>{y.classList.remove("focus")}))}else{const I=u.current.querySelector(".search-popover-item");I&&I.classList.add("focus")}}break;case"Up":case"ArrowUp":if(p.preventDefault(),i){const m=document.querySelector(".search-popover-item.focus");if(m){let I=m.previousElementSibling;for(;I&&I.hidden;)I=I.previousElementSibling;I&&(I.classList.add("focus"),Array.from(I.parentElement.children).filter(y=>y!==I).forEach(y=>{y.classList.remove("focus")}))}else{const I=document.querySelector(".search-popover-item:last-child");I&&I.classList.add("focus")}}break;case"Enter":if(i){const m=document.querySelector(".search-popover-item.focus");m&&(p.preventDefault(),m.click()),h(!1),(g=t==null?void 0:t.onSubmit)==null||g.call(t,p)}break}}}),e("div",{class:"search-popover",hidden:!i||!l,children:!!l&&[{label:e(x,{children:[l," ",e("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(l)}`,top:!d&&!/\s/.test(l),hidden:!!d},{label:e(x,{children:["Posts with ",e("q",{children:l})]}),to:`/search?q=${encodeURIComponent(l)}&type=statuses`,hidden:/^https?:/.test(l),top:/\s/.test(l),icon:"document",queryType:"statuses"},{label:e(x,{children:["Posts tagged with ",e("mark",{children:["#",l.replace(/^#/,"")]})]}),to:`/${s}/t/${l.replace(/^#/,"")}`,hidden:/^@/.test(l)||/^https?:/.test(l)||/\s/.test(l),top:/^#/.test(l),type:"link",icon:"hashtag",queryType:"hashtags"},{label:e(x,{children:["Look up ",e("mark",{children:l})]}),to:`/${l}`,hidden:!/^https?:/.test(l),top:/^https?:/.test(l),type:"link"},{label:e(x,{children:["Accounts with ",e("q",{children:l})]}),to:`/search?q=${encodeURIComponent(l)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((p,f)=>{if(d){if(p.queryType===d)return-1;if(f.queryType===d)return 1}return p.top&&!f.top?-1:!p.top&&f.top?1:0}).filter(({hidden:p})=>!p).map(({label:p,to:f,icon:g,type:m},I)=>e(J,{to:f,class:`search-popover-item ${I===0?"focus":""}`,onClick:b=>{var y;(y=t==null?void 0:t.onSubmit)==null||y.call(t,b)},children:[e(w,{icon:g||(m==="link"?"arrow-right":"search"),class:"more-insignificant"}),e("span",{children:p})," "]}))})]})}),Yi=Be(function({onClose:n=()=>{}}){const[s,o]=C(!1),a=U(null);Me(["Slash","/"],h=>{o(!0),setTimeout(()=>{var l,c,d,u;(c=(l=a.current)==null?void 0:l.focus)==null||c.call(l),(u=(d=a.current)==null?void 0:d.select)==null||u.call(d)},0)},{preventDefault:!0,ignoreEventWhen:h=>{const l=/\/search/.test(location.hash),c=!!document.querySelector("#modal-container > *");return l||c}});const i=()=>{o(!1),n()};return Me("esc",h=>{var l,c;(c=(l=a.current)==null?void 0:l.blur)==null||c.call(l),i()},{enabled:s,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!s,onClick:h=>{h.target===h.currentTarget&&i()},children:e(as,{ref:a,onSubmit:()=>{i()}})})});function Wi(){const{instance:t}=B(),n=me(S),{shortcuts:s,settings:o}=n;if(!s.length||o.shortcutsViewMode==="multi-column"||!o.shortcutsViewMode&&o.shortcutsColumnsMode)return null;const a=U(),i=de(()=>s.map((l,c)=>{const{type:d,...u}=l;if(!At[d])return null;let{id:r,path:p,title:f,subtitle:g,icon:m}=At[d];return typeof r=="function"&&(r=r(u,c)),typeof p=="function"&&(p=p({...u,instance:u.instance||t},c)),typeof f=="function"&&(f=f(u,c)),typeof g=="function"&&(g=g(u,c)),typeof m=="function"&&(m=m(u,c)),{id:r,path:p,title:f,subtitle:g,icon:m}}).filter(Boolean),[s]),h=Wn();return Me(["1","2","3","4","5","6","7","8","9"],(l,c)=>{var u,r;const d=parseInt(c.keys[0],10)-1;if(d<i.length){const{path:p}=i[d];p&&(h(p),(r=(u=a.current)==null?void 0:u.closeMenu)==null||r.call(u))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",onContextMenu:l=>{l.preventDefault(),S.showShortcutsSettings=!0},children:e("ul",{children:i.map(({id:l,path:c,title:d,subtitle:u,icon:r},p)=>e("li",{children:e(J,{class:u?"has-subtitle":"",to:c,onClick:f=>{if(f.target.classList.contains("is-active")){f.preventDefault();const g=document.getElementById(`${l}-page`);if(g){g.scrollTop=0;const m=g.querySelector(".updates-button");m&&m.click()}}},children:[e(w,{icon:r,size:"xl",alt:d}),e("span",{children:[e(Bt,{children:d}),u&&e(x,{children:[e("br",{}),e("small",{children:u})]})]})]})},`${p}-${l}-${d}-${u}-${c}`))})}):e(He,{instanceRef:a,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:l=>{l.preventDefault(),S.showShortcutsSettings=!0},onTransitionStart:l=>{var c,d;try{const{target:u}=l;getComputedStyle(u).pointerEvents==="none"&&((d=(c=a.current)==null?void 0:c.closeMenu)==null||d.call(c))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:i.map(({id:l,path:c,title:d,subtitle:u,icon:r},p)=>e(Ee,{to:c,class:"glass-menu-item",children:[e(w,{icon:r,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Bt,{children:d})}),u&&e(x,{children:[" ",e("small",{class:"more-insignificant",children:u})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:p+1})]},`${p}-${l}-${d}-${u}-${c}`))})})}const Ki=Be(Wi);function Zi(t){var a;let n=[],s=[],o=0;for(let i=0;i<t.length;i++){const h=t[i];h.reblog&&!((a=h.account)!=null&&a.group)?(s.push(h),o++):(n.push(h),o<3&&(o=0))}if(t.length>10&&(s.length>t.length/4||o>=3)){const i=s.map(h=>h.id);if(s.length>t.length*3/4)n=[...n,{id:i,items:s,type:"boosts"}];else{const h=Math.floor(n.length/2);n=[...n.slice(0,h),{id:i,items:s,type:"boosts"},...n.slice(h)]}return n}else return t}function In(t,n){const s=se.account.get("boostedStatusIDs")||{},o=t.filter(i=>{if(!i.reblog)return!0;const h=`${n}-${i.reblog.id}`,l=s[h];return l&&l!==i.id?!1:(s[h]=i.id,!0)}),a=Object.keys(s);return a.length>50&&a.slice(0,a.length-50).forEach(i=>{delete s[i]}),se.account.set("boostedStatusIDs",s),o}function Ji(t,n){const s=[];let o=0;t.forEach(h=>{for(let c=0;c<s.length;c++){if(s[c].find(d=>d.id===h.id))return;if(s[c].find(d=>d.id===h.inReplyToId)||s[c].find(d=>d.inReplyToId===h.id)){s[c].push(h);return}}const l=t.find(c=>c.id===h.inReplyToId);l&&(s[o++]=[h,l])});for(let h=0;h<s.length;h++)for(let l=h+1;l<s.length;l++)s[h].find(d=>s[l].includes(d))&&(s[h]=[...s[h],...s[l]],s[h]=s[h].filter((d,u,r)=>r.findIndex(p=>p.id===d.id)===u),s.splice(l,1),l--);s.forEach(h=>{h.sort((l,c)=>!l.inReplyToId&&!c.inReplyToId?new Date(l.createdAt)-new Date(c.createdAt):l.inReplyToId===c.id?1:c.inReplyToId===l.id||!l.inReplyToId?-1:c.inReplyToId?new Date(l.createdAt)-new Date(c.createdAt):1)}),s.forEach(h=>{const l=h[0].account.id;h.forEach(c=>{c.account.id!==l&&(c._differentAuthor=!0)})}),s.length;const a=[],i=[];return t.forEach(h=>{if(h.reblog){a.push(h);return}for(let l=0;l<s.length;l++)if(s[l].find(c=>c.id===h.id)){if(i.includes(l))return;const c=s[l];c.sort((u,r)=>{const p=new Date(u.createdAt),f=new Date(r.createdAt);return p-f});const d=c[0].account.id;a.push({id:c.map(u=>u.id),items:c,type:c.every(u=>u.account.id===d)?"thread":"conversation"}),i.push(l);return}if(h.inReplyToId&&h.inReplyToAccountId!==h.account.id){const l=Ye(h.id,n);S.statusReply[l]||queueMicrotask(async()=>{try{const{masto:c}=B({instance:n}),d=await Xi(h.inReplyToId,c);$e(d,n,{skipThreading:!0,skipUnfurling:!0}),S.statusReply[l]={id:d.id,instance:n}}catch{}})}a.push(h)}),a}const Xi=tt((t,n)=>n.v1.statuses.$select(t).fetch());async function Qi(t,n){const s=await Pi();if(!s.length)return;const{statusFollowedTags:o}=S,a=[];if(t.forEach(i=>{var p;if(i.reblog)return;const{id:h,content:l,tags:c=[]}=i,d=Ye(h,n);if((p=o[d])!=null&&p.length)return;const u=Di(l);if(!u.length&&!c.length)return;const r=s.reduce((f,g)=>((u.some(m=>m.toLowerCase()===g.name.toLowerCase())||c.some(m=>m.name.toLowerCase()===g.name.toLowerCase()))&&f.push(g.name),f),[]);r.length&&a.push({item:i,sKey:d,followedTags:r})}),a.length){const i=a.map(l=>l.item.account),h=await Jt(i);if(!h)return;a.forEach(l=>{const{item:c,sKey:d,followedTags:u}=l,r=h[c.account.id];r&&!r.following&&(o[d]=u)})}}function eo(){S.statusFollowedTags={}}function to({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:o=10,scrollThresholdEnd:a=10,direction:i="vertical",distanceFromStartPx:h,distanceFromEndPx:l}={}){const[c,d]=C(null),[u,r]=C(!1),[p,f]=C(!1),[g,m]=C(!1),[I,b]=C(!1),y=i==="vertical";return Je(()=>{const k=t.current;if(!k)return{};let v=y?k.scrollTop:k.scrollLeft;function T(){const{scrollTop:$,scrollLeft:L,scrollHeight:q,scrollWidth:O,clientHeight:E,clientWidth:D}=k,A=y?$:L,_=y?q:O,M=y?E:D,K=Math.abs(A-v),z=h||Math.min(M*n,_,A),ee=l||Math.min(M*s,_,_-A-M);K>=(v<A?a:o)&&(d(v<A?"end":"start"),v=A),r(A<=0),f(A+M>=_),m(A<=z),b(A+M>=_-ee)}return k.addEventListener("scroll",T,{passive:!0}),()=>k.removeEventListener("scroll",T)},[n,s,o,a]),{scrollDirection:c,reachStart:u,reachEnd:p,nearReachStart:g,nearReachEnd:I,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function no({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:o=10,scrollThresholdEnd:a=10,direction:i="vertical",distanceFromStartPx:h,distanceFromEndPx:l,init:c}={},d,u){if(!d)return;const r=i==="vertical",p=U(null),f=U(null),g=Us(()=>{let m=!1,I=!1,b=!1,y=!1;const k=t.current,{scrollTop:v,scrollLeft:T,scrollHeight:$,scrollWidth:L,clientHeight:q,clientWidth:O}=k,E=r?v:T,D=r?$:L,A=r?q:O,_=Math.abs(E-p.current),M=h||Math.min(A*n,D,E),K=l||Math.min(A*s,D,D-E-A);_>=(p.current<E?a:o)&&(f.current=p.current<E?"end":"start",p.current=E),m=E<=0,I=E+A>=D,b=E<=M,y=E+A>=D-K,d({scrollDirection:f.current,reachStart:m,reachEnd:I,nearReachStart:b,nearReachEnd:y})},500);Je(()=>{const m=t.current;return m?(p.current=m[r?"scrollTop":"scrollLeft"],m.addEventListener("scroll",g,{passive:!0}),()=>m.removeEventListener("scroll",g)):{}},[n,s,o,a,...u]),H(()=>{c&&t.current&&queueMicrotask(()=>{t.current.dispatchEvent(new Event("scroll"))})},[c])}function so({class:t,statusID:n,status:s,instance:o,parent:a,onMediaClick:i}){let h=Ye(n,o);const l=me(S);if(s||(s=l.statuses[h]||l.statuses[n],h=Ye(s==null?void 0:s.id,o)),!s)return null;const{account:{acct:c,avatar:d,avatarStatic:u,id:r,url:p,displayName:f,username:g,emojis:m,bot:I,group:b},id:y,repliesCount:k,reblogged:v,reblogsCount:T,favourited:$,favouritesCount:L,bookmarked:q,poll:O,muted:E,sensitive:D,spoilerText:A,visibility:_,language:M,editedAt:K,filtered:z,card:ee,createdAt:Q,inReplyToId:pe,inReplyToAccountId:ge,content:Y,mentions:P,mediaAttachments:W,reblog:X,uri:re,url:be,emojis:ve,_deleted:Se,_pinned:xe}=s;if(!(W!=null&&W.length))return null;const V=Pe=>{Pe.shiftKey},te=de(()=>se.session.get("currentAccount"),[]),F=de(()=>te&&te===r,[r,te]),ie=Fs(Hn),ue=!F&&Ot(z,ie);if((ue==null?void 0:ue.action)==="hide")return null;const G=D,ke=de(()=>(se.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",Ae=a||"div";return W.map((Pe,R)=>{const j=`${h}-${Pe.id}`,Z=ue==null?void 0:ue.titlesStr;return e(Ae,{"data-state-post-id":h,onMouseEnter:V,"data-spoiler-text":A||(D?"Sensitive media":void 0),"data-filtered-text":ue?`Filtered${Z?`: ${Z}`:""}`:void 0,class:`
          media-post
          ${ue?"filtered":""}
          ${G?"has-spoiler":""}
          ${ke?"show-media":""}
        `,children:e(qn,{class:t,media:Pe,lang:M,to:`/${o}/s/${y}?media-only=${R+1}`,onClick:i?N=>i(N,R,Pe,s):void 0})},j)})}const Tn=Be(so);function io(t){var v,T,$,L,q;const n=me(S),{masto:s,instance:o,authenticated:a}=B(),[i,h]=C(),[l,c]=C(!1);H(()=>{const O=se.local.getJSON("accounts")||[],E=O.find(D=>D.info.id===se.session.get("currentAccount"));E&&h(E),c(O.length>1)},[]);const d=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(O=>O.type==="following"),u=Os(()=>{S.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),r=U(),[p,f]=C(void 0),g=As([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),m=U();async function I(O){return(O||!m.current)&&(m.current=s.v1.mutes.list({limit:80})),await m.current.next()}const b=U();async function y(O){return(O||!b.current)&&(b.current=s.v1.blocks.list({limit:80})),await b.current.next()}const k=U();return e(x,{children:[e("button",{ref:r,type:"button",class:`button plain nav-menu-button ${l?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{k.current=Date.now(),f(O=>O?void 0:"open")},onContextMenu:O=>{O.preventDefault(),S.showAccounts=!0},...u(),children:[l&&e(st,{url:((v=i==null?void 0:i.info)==null?void 0:v.avatar)||((T=i==null?void 0:i.info)==null?void 0:T.avatarStatic),size:"l",squircle:($=i==null?void 0:i.info)==null?void 0:$.bot}),e(w,{icon:"menu",size:l?"s":"l"})]}),e(Kn,{menuClassName:"nav-menu",state:p,anchorRef:r,onClose:()=>{f(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-k.current<300||f(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:g,unmountOnClose:!0,children:[!!((L=n.appVersion)!=null&&L.commitHash)&&n.appVersion.commitHash!=="77818d3"&&e("div",{class:"top-menu",children:[e(ae,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(De,{})]}),e("section",{children:[e(Ee,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),a&&e(x,{children:[d&&e(Ee,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Ee,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Ee,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(De,{}),e(Ee,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Ee,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Ee,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Ee,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]})]}),e(De,{}),e(Ee,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Ee,{to:`/${o}/p/l`,children:[e(w,{icon:"building",size:"l"})," ",e("span",{children:"Local"})]}),e(Ee,{to:`/${o}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Ee,{to:`/${o}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:a?e(x,{children:[e(De,{}),((q=i==null?void 0:i.info)==null?void 0:q.id)&&e(Ee,{to:`/${o}/a/${i.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(ae,{onClick:()=>{S.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(ae,{onClick:()=>{S.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:I,excludeRelationshipAttrs:["muting"]}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(ae,{onClick:()=>{S.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:y,excludeRelationshipAttrs:["blocking"]}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(De,{className:"divider-grow"}),e(ae,{onClick:()=>{S.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(ae,{onClick:()=>{S.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(ae,{onClick:()=>{S.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(x,{children:[e(De,{}),e(Ee,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(ae,{onClick:()=>{S.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const bt=Be(io),wt={block:"nearest",inline:"center",behavior:"smooth"};function Xe({title:t,titleComponent:n,id:s,instance:o,emptyText:a,errorText:i,useItemID:h,boostsCarousel:l,fetchItems:c=()=>{},checkForUpdates:d=()=>{},checkForUpdatesInterval:u=15e3,headerStart:r,headerEnd:p,timelineStart:f,refresh:g,view:m,filterContext:I,showFollowedTags:b,showReplyParent:y}){const k=me(S),[v,T]=C([]),[$,L]=C("default"),[q,O]=C(!1),[E,D]=C(!1),[A,_]=C(!0),M=U(),K=m!=="media",z=zs(V=>{D(!1),$!=="loading"&&(L("loading"),(async()=>{try{let{done:te,value:F}=await c(V);if(Array.isArray(F)){const[ie,ue]=F.reduce((G,le)=>(le._pinned?G[0].push(le):G[1].push(le),G),[[],[]]);F=ue,K&&(l&&(F=Zi(F)),F=Ji(F,o)),ie.length&&(F=ie.concat(F)),T(V?F:G=>[...G,...F]),F.length||(te=!0),O(!te)}else O(!1);L("default")}catch{L("error")}finally{z.cancel()}})())},1500,{leading:!0,trailing:!1}),ee=".timeline-item, .timeline-item-alt",Q=Me("j, shift+j",(V,te)=>{const F=document.activeElement.closest(ee),ie=F==null?void 0:F.getBoundingClientRect(),ue=Array.from(M.current.querySelectorAll(ee));if(F&&ie.top<M.current.clientHeight&&ie.bottom>0){const G=ue.indexOf(F);let le=ue[G+1];te.shift&&(le=ue.find((ke,Ae)=>Ae>G&&!ke.classList.contains("timeline-item-alt"))),le&&(le.focus(),le.scrollIntoView(wt))}else{const G=ue.find(le=>{const ke=le.getBoundingClientRect();return ke.top>=44&&ke.left>=0});G&&(G.focus(),G.scrollIntoView(wt))}}),pe=Me("k, shift+k",(V,te)=>{const F=document.activeElement.closest(ee),ie=F==null?void 0:F.getBoundingClientRect(),ue=Array.from(M.current.querySelectorAll(ee));if(F&&ie.top<M.current.clientHeight&&ie.bottom>0){const G=ue.indexOf(F);let le=ue[G-1];te.shift&&(le=ue.findLast((ke,Ae)=>Ae<G&&!ke.classList.contains("timeline-item-alt"))),le&&(le.focus(),le.scrollIntoView(wt))}else{const G=ue.find(le=>{const ke=le.getBoundingClientRect();return ke.top>=44&&ke.left>=0});G&&(G.focus(),G.scrollIntoView(wt))}}),ge=Me(["enter","o"],()=>{const V=document.activeElement.closest(ee);V&&V.click()}),Y=v.length>0&&$!=="loading"&&E,P=Ge(()=>{var V;z(!0),(V=M.current)==null||V.scrollTo({top:0,behavior:"smooth"})},[z]),W=Me(".",()=>{Y&&P()}),X=U(),[re,be]=C(!1);no({scrollableRef:M,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:V,nearReachStart:te,reachStart:F})=>{if(X.current){const ie=V==="end"&&!te;X.current.hidden=ie}be(te),F&&z(!0)},[]),H(()=>{var V;(V=M.current)==null||V.scrollTo({top:0}),z(!0)},[]),H(()=>{z(!0)},[g]);const ve=U(m);H(()=>{ve.current!==m&&(ve.current=m,T([]))},[m]);const Se=Ge(async({disableIdleCheck:V=!1}={})=>{const te=M.current?getComputedStyle(M.current).pointerEvents==="none":!1;k.settings.autoRefresh&&M.current.scrollTop<16&&(V||window.__IDLE__)&&!ro()&&!te?z(!0):await d()&&D(!0)},[s,z,d,k.settings.autoRefresh]),xe=U();return lt(V=>{if(V){const te=Date.now()-xe.current;(!xe.current||te>1e3*3)&&Se({disableIdleCheck:!0})}else xe.current=Date.now();_(V)},[d,Se,k.settings.autoRefresh]),Nn(Se,A&&!E?u*(re?1:2):null),e(Hn.Provider,{value:I,children:e("div",{id:`${s}-page`,class:"deck-container",ref:V=>{M.current=V,Q.current=V,pe.current=V,ge.current=V},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{ref:X,onClick:V=>{var te;V.target.closest("a, button")||(te=M.current)==null||te.scrollTo({top:0,behavior:"smooth"})},onDblClick:V=>{V.target.closest("a, button")||z(!0)},class:$==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),r??e(J,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!p&&p})]}),Y&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:P,children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!f&&e("div",{class:`timeline-start ${$==="loading"?"loading":""}`,children:f}),v.length?e(x,{children:[e("ul",{class:`timeline ${m?`timeline-${m}`:""}`,children:[v.map(V=>e(oo,{status:V,instance:o,useItemID:h,filterContext:I,view:m,showFollowedTags:b,showReplyParent:y},V.id+(V==null?void 0:V._pinned)+m)),q&&$==="loading"&&(m==="media"?null:e(x,{children:[e("li",{style:{height:"20vh"},children:e(Le,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(Le,{skeleton:!0})})]}))]}),$==="default"&&(q?e(Ze,{root:M.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:V=>{V&&z()},children:e("button",{type:"button",class:"plain block",onClick:()=>z(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):$==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((V,te)=>m==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(Le,{skeleton:!0})},te))}):$!=="error"&&e("p",{class:"ui-state",children:a}),$==="error"&&e("p",{class:"ui-state",children:[i,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>z(!v.length),children:"Try again"})]})]})})})}const oo=Be(({status:t,instance:n,useItemID:s,filterContext:o,view:a,showFollowedTags:i,showReplyParent:h})=>{const{id:l,reblog:c,items:d,type:u,_pinned:r}=t;r&&(s=!1);const p=(c==null?void 0:c.id)||l,f=n?`/${n}/s/${p}`:`/s/${p}`;let g="";u==="boosts"?g=`${d.length} Boosts`:u==="pinned"&&(g="Pinned posts");const m=u==="boosts"||u==="pinned";if(d){const b=dt(d,o);if(m)return b.sort((k,v)=>{const T=Ot(k.filtered,o),$=Ot(v.filtered,o);return T&&!$?1:!T&&$?-1:0}),e("li",{class:"timeline-item-carousel",children:e(ao,{title:g,class:`${u}-carousel`,children:b.map(k=>{const{id:v,reblog:T,_pinned:$}=k,L=(T==null?void 0:T.id)||v,q=n?`/${n}/s/${L}`:`/s/${L}`;return $&&(s=!1),e("li",{children:e(J,{class:"status-carousel-link timeline-item-alt",to:q,children:s?e(Le,{statusID:v,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):e(Le,{status:k,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},v)})})},`timeline-${l}`);const y=b.length>3;return b.map((k,v)=>{const{id:T,_differentAuthor:$}=k,L=n?`/${n}/s/${T}`:`/s/${T}`,q=v>0&&v<b.length-1,O=k.sensitive&&!!k.spoilerText,E=!$&&O&&v>0||y&&q&&(u==="thread"||u==="conversation"&&!$&&!b[v-1]._differentAuthor&&!b[v+1]._differentAuthor),D=v===0,A=v===b.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${u} timeline-item-container-${D?"start":A?"end":"middle"} ${$?"timeline-item-diff-author":""}`,children:e(J,{class:"status-link timeline-item",to:L,children:E?e(co,{status:k,instance:n}):s?e(Le,{statusID:T,instance:n,enableCommentHint:A,showFollowedTags:i}):e(Le,{status:k,instance:n,enableCommentHint:A,showFollowedTags:i})})},`timeline-${T}`)})}const I=`timeline-${l+r}`;return a==="media"?s?e(Tn,{class:"timeline-item",parent:"li",statusID:l,instance:n},I):e(Tn,{class:"timeline-item",parent:"li",status:t,instance:n},I):e("li",{children:e(J,{class:"status-link timeline-item",to:f,children:s?e(Le,{statusID:l,instance:n,enableCommentHint:!0,showFollowedTags:i,showReplyParent:h}):e(Le,{status:t,instance:n,enableCommentHint:!0,showFollowedTags:i,showReplyParent:h})})},I)},(t,n)=>{var a,i;const s=(((a=t.status)==null?void 0:a.id)||"").toString(),o=(((i=n.status)==null?void 0:i.id)||"").toString();return s===o&&t.instance===n.instance&&t.view===n.view});function ao({title:t,class:n,children:s}){const o=U(),a=U(),i=U(),[h,l]=C(!1);return H(()=>{setTimeout(()=>{l(!0)},1)},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{ref:a,type:"button",class:"small plain2",onClick:()=>{var c,d;(d=o.current)==null||d.scrollBy({left:-Math.min(320,(c=o.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{ref:i,type:"button",class:"small plain2",onClick:()=>{var c,d;(d=o.current)==null||d.scrollBy({left:Math.min(320,(c=o.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:o,children:[e(Ze,{class:"status-carousel-beacon",onChange:c=>{a.current&&(a.current.disabled=c)}}),s[0],h&&s.slice(1),e(Ze,{class:"status-carousel-beacon",onChange:c=>{i.current&&(i.current.disabled=c)}})]})]})}function co({status:t,instance:n}){const s=me(S),{id:o,visibility:a,language:i}=t,h=Vn(t),l=Ye(o,n);return e("article",{class:`status compact-thread ${a==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[s.statusThreadNumber[l]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),s.statusThreadNumber[l]?` ${s.statusThreadNumber[l]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:h,lang:i,dir:"auto",children:[h,t.sensitive&&t.spoilerText&&e(x,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function ro(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const ct=20,Qt=1983,Cn=`${Qt}-01`,lo=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function uo(t){var o;const{masto:n}=B({instance:t}),s=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((o=s==null?void 0:s.statuses)!=null&&o.length)}const ho=tt(uo);function fo(){const t=me(S),{id:n,...s}=it(),[o,a]=We(),i=o.get("month"),h=!o.get("replies"),l=!!o.get("boosts"),c=o.get("tagged"),d=!!o.get("media"),{masto:u,instance:r,authenticated:p}=B({instance:s.instance}),{masto:f,instance:g}=B(),m=U(),I=[i,h,l,c,d],[b,y]=C(),k=U(0);H(()=>{k.current=0},I);const v=de(()=>r===g,[r,g]),[T,$]=C(!1);H(()=>{v&&b!=null&&b.acct&&(async()=>{const Y=await ho(r);$(Y)})()},[r,v,b==null?void 0:b.acct]);async function L(Y){var ve,Se,xe;const P=/^\d{4}-[01]\d$/.test(i),W=((Se=(ve=i==null?void 0:i.split)==null?void 0:ve.call(i,"-"))==null?void 0:Se[0])>=Qt;if(P&&W){if(!b)return{value:[],done:!0};const[V,te]=i.split("-"),F=parseInt(te,10)-1,ie=new Date(V,F,0),ue=`${ie.getFullYear()}-${(ie.getMonth()+1).toString().padStart(2,"0")}-${ie.getDate().toString().padStart(2,"0")}`,G=new Date(V,F+1,1),le=`${G.getFullYear()}-${(G.getMonth()+1).toString().padStart(2,"0")}-${G.getDate().toString().padStart(2,"0")}`;let ke;Y?(ke=ct+1,k.current=0):(ke=ct+k.current+1,k.current+=ct);const Ae=await u.v2.search.fetch({q:`from:${b.acct} after:${ue} before:${le}`,type:"statuses",limit:ke,offset:k.current});if((xe=Ae==null?void 0:Ae.statuses)!=null&&xe.length){const Pe=Ae.statuses.slice(0,ct);Pe.forEach(j=>{$e(j,r)});const R=Ae.statuses.length<=ct;return{value:Pe,done:R}}else return{value:[],done:!0}}const X=[];if(Y){const{value:V}=await u.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(V!=null&&V.length&&!c&&!d){const te=V.map(F=>($e(F,r),{...F,_pinned:!0}));if(te.length>=3){const F=te.map(ie=>ie.id);X.push({id:F,items:te,type:"pinned"})}else X.push(...te)}}(Y||!m.current)&&(m.current=u.v1.accounts.$select(n).statuses.list({limit:ct,exclude_replies:h,exclude_reblogs:l,only_media:d,tagged:c}));const{value:re,done:be}=await m.current.next();return re!=null&&re.length&&(X.push(...re),re.forEach(V=>{$e(V,r)})),{value:X,done:be}}const[q,O]=C([]);_e(b!=null&&b.acct?`${b!=null&&b.displayName?b.displayName+" ":""}@${b.acct}${h?l?" (- Boosts)":c?` (#${c})`:d?" (Media)":i?` (${new Date(i).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const E=U(),D=Ge(()=>{const Y=E.current||u.v1.accounts.$select(n).fetch();return E.current=Y,Y},[n,u]);H(()=>{(async()=>{try{const Y=await D();y(Y)}catch{}try{const Y=await u.v1.accounts.$select(n).featuredTags.list();O(Y)}catch{}})()},[n]);const{displayName:A,acct:_,emojis:M}=b||{},K=de(()=>{const Y=t.accounts[`${n}@${r}`];return e(ts,{instance:r,account:Y||n,fetchAccount:D,authenticated:p,standalone:!0})},[n,r,p,D]),z=U(),ee=de(()=>e(x,{children:[K,e("div",{class:"filter-bar",ref:z,style:{position:"relative"},children:[!h||l||c||d||!!i?e(J,{to:`/${r}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(J,{to:`/${r}/a/${n}${h?"?replies=1":""}`,onClick:()=>{h&&fe("Showing post with replies")},class:h?"":"is-active",children:"+ Replies"}),e(J,{to:`/${r}/a/${n}${l?"":"?boosts=0"}`,onClick:()=>{l||fe("Showing posts without boosts")},class:l?"is-active":"",children:"- Boosts"}),e(J,{to:`/${r}/a/${n}${d?"":"?media=1"}`,onClick:()=>{d||fe("Showing posts with media")},class:d?"is-active":"",children:"Media"}),q.map(P=>e(J,{to:`/${r}/a/${n}${c===P.name?"":`?tagged=${encodeURIComponent(P.name)}`}`,onClick:()=>{c!==P.name&&fe(`Showing posts tagged with #${P.name}`)},class:c===P.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),P.name]})},P.id)),T&&(lo?e("label",{class:`filter-field ${i?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(b!=null&&b.acct),value:i||"",min:Cn,max:new Date().toISOString().slice(0,7),onInput:P=>{const{value:W,validity:X}=P.currentTarget;if(!X.valid)return;a(W?{month:W}:{});const[re,be]=W.split("-"),ve=parseInt(be,10)-1,Se=new Date(re,ve);fe(`Showing posts in ${Se.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):e(po,{class:`filter-field ${i?"is-active":""}`,disabled:!(b!=null&&b.acct),value:i||"",min:Cn,max:new Date().toISOString().slice(0,7),onInput:P=>{const{value:W,validity:X}=P;X.valid&&a(W?{month:W}:{})}}))]})]}),[n,r,p,q,T,...I]);H(()=>{var P;const Y=(P=z.current)==null?void 0:P.querySelector(".is-active");Y&&z.current.scrollTo({behavior:"smooth",left:Y.offsetLeft-(z.current.offsetWidth-Y.offsetWidth)/2})},[q,T,...I]);const Q=de(()=>b!=null&&b.url?new URL(b.url).hostname:null,[b]),ge=!!b&&!(r===Q);return e(Xe,{title:`${b!=null&&b.acct?"@"+b.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(On,{text:A,emojis:M})}),e("div",{children:e("span",{children:["@",_]})})]}),id:"account-statuses",instance:r,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:L,useItemID:!0,view:d?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:ee,refresh:[h,l,c,d,i+(b==null?void 0:b.acct)].toString(),headerEnd:e(He,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ae,{disabled:!ge,onClick:()=>{(async()=>{try{const{masto:Y}=B({instance:Q}),P=await Y.v1.accounts.lookup({acct:b.acct}),{id:W}=P;location.hash=`/${Q}/a/${W}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:Q}),")"]})]}),!v&&e(ae,{onClick:()=>{(async()=>{try{const Y=await f.v1.accounts.lookup({acct:b.acct+"@"+r}),{id:P}=Y;location.hash=`/${g}/a/${P}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to my instance (",e("b",{children:g}),")"]})]})]})},n)}function po(t){const{class:n,disabled:s,value:o,min:a,max:i,onInput:h=()=>{}}=t,[l,c]=(o==null?void 0:o.split("-"))||[],d=U(),u=U(),r=(p,f)=>{const[g,m]=(a==null?void 0:a.split("-"))||[],[I,b]=(i==null?void 0:i.split("-"))||[];return!(f<g||f>I||f===g&&p<m||f===I&&p>b)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:d,disabled:s,value:c||"",onInput:p=>{const{value:f}=p.currentTarget,g=u.current.value;if(!r(f,g))return{value:"",validity:{valid:!1}};h({value:f?`${g}-${f}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(p,f)=>e("option",{value:(f+1).toString().padStart(2,"0"),children:new Date(0,f).toLocaleString("default",{month:"long"})},f))]})," ",e("input",{ref:u,type:"number",disabled:s,value:l||new Date().getFullYear(),min:(a==null?void 0:a.slice(0,4))||Qt,max:(i==null?void 0:i.slice(0,4))||new Date().getFullYear(),onInput:p=>{const{value:f,validity:g}=p.currentTarget,m=d.current.value;if(!g.valid||!r(m,f))return{value:"",validity:{valid:!1}};h({value:f?`${f}-${m}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const mo=20;function cs(){_e("Bookmarks","/b");const{masto:t,instance:n}=B(),s=U();async function o(a){return(a||!s.current)&&(s.current=t.v1.bookmarks.list({limit:mo})),await s.current.next()}return e(Xe,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const go=20;function rs(){_e("Likes","/f");const{masto:t,instance:n}=B(),s=U();async function o(a){return(a||!s.current)&&(s.current=t.v1.favourites.list({limit:go})),await s.current.next()}return e(Xe,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:o})}function bo(){const{masto:t,instance:n}=B();_e("Followed Hashtags","/ft");const[s,o]=C("default"),[a,i]=C([]);return H(()=>{o("loading"),(async()=>{try{const h=await xt();i(h),o("default")}catch{o("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),e(J,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:a.length>0?e(x,{children:[e("ul",{class:"link-list",children:a.map(h=>e("li",{children:e(J,{to:n?`/${n}/t/${h.name}`:`/t/${h.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:h.name})]})}))}),a.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[a.length," hashtag",a.length===1?"":"s"]})})]}):s==="loading"?e("p",{class:"ui-state",children:e(we,{abrupt:!0})}):s==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const yo=20;function en({title:t,path:n,id:s,...o}){_e(t||"Following",n||"/following");const{masto:a,streaming:i,instance:h}=B(),l=me(S),c=U(),d=U();async function u(p){(p||!c.current)&&(c.current=a.v1.timelines.home.list({limit:yo}));const f=await c.current.next();let{value:g}=f;if(g!=null&&g.length){let m=!1;p&&(g[0].id!==d.current&&(m=!0),d.current=g[0].id),g.forEach(I=>{$e(I,h)}),g=In(g,h),p&&m&&eo(),Qi(g,h),g.sort((I,b)=>{const y=new Date(I.createdAt);return new Date(b.createdAt)-y})}return{...f,value:g}}async function r(){try{const p=await a.v1.timelines.home.list({limit:5,since_id:d.current}).next();let{value:f}=p;return!!(f!=null&&f.length&&(d.current=f[0].id,f=In(f,h),f=dt(f,"home"),f.some(g=>!g.reblog)))}catch{return!1}}return H(()=>{let p;return(async()=>{if(i){p=i.user.subscribe();for await(const f of p){if(!p)break;if(f.event==="status.update"){const g=f.payload;$e(g,h)}else if(f.event==="delete"){const g=f.payload,m=Gn(g,h);m&&(m._deleted=!0)}}}})(),()=>{var f;(f=p==null?void 0:p.unsubscribe)==null||f.call(p),p=null}},[i]),e(Xe,{title:t||"Following",id:s||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:h,fetchItems:u,checkForUpdates:r,useItemID:!0,boostsCarousel:l.settings.boostsCarousel,...o,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const wo=20,vo=4,$n=vo+1;function ls({media:t,columnMode:n,...s}){let{hashtag:o,...a}=n?{}:it();s.hashtag&&(o=s.hashtag);let i=o.trim().split(/[\s+]+/);i.sort(),o=i[0];const[h,l]=We(),c=t||!!h.get("media"),d=c?"?media=1":"",{masto:u,instance:r,authenticated:p}=B({instance:(s==null?void 0:s.instance)||a.instance}),{masto:f,instance:g,authenticated:m}=B(),I=i.map(A=>`#${A}`).join(" "),b=c?" (Media only)":"",y=r?`${I}${b} on ${r}`:`${I}${b}`;_e(y,"/:instance?/t/:hashtag");const k=U(),v=U(void 0);async function T(A){const _=await u.v1.timelines.tag.$select(o).list({limit:wo,any:i.slice(1),maxId:A?void 0:v.current,onlyMedia:c}).next();let{value:M}=_;return M!=null&&M.length&&(A&&(k.current=M[0].id),M.forEach(K=>{$e(K,r,{skipThreading:c})}),v.current=M[M.length-1].id),{..._,value:M}}async function $(){try{const A=await u.v1.timelines.tag.$select(o).list({limit:1,any:i.slice(1),since_id:k.current,onlyMedia:c}).next();let{value:_}=A;return _=dt(_,"public"),!!(_!=null&&_.length)}catch{return!1}}const[L,q]=C("default"),[O,E]=C();H(()=>{(async()=>{try{const A=await u.v1.tags.$select(o).fetch();E(A)}catch{}})()},[o]);const D=i.length>=$n;return e(Xe,{title:y,titleComponent:!!r&&e("h1",{class:"header-double-lines",children:[e("b",{children:I}),e("div",{children:r})]}),id:"hashtag",instance:r,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:T,checkForUpdates:$,useItemID:!0,view:c?"media":void 0,refresh:c,filterContext:"public",headerEnd:e(He,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!O&&i.length===1&&e(x,{children:[e(je,{subMenu:!0,confirm:O.following,confirmLabel:`Unfollow #${o}?`,disabled:L==="loading"||!p,onClick:()=>{q("loading"),O.following?u.v1.tags.$select(o).unfollow().then(()=>{E({...O,following:!1}),fe(`Unfollowed #${o}`)}).catch(A=>{alert(A)}).finally(()=>{q("default")}):u.v1.tags.$select(o).follow().then(()=>{E({...O,following:!0}),fe(`Followed #${o}`)}).catch(A=>{alert(A)}).finally(()=>{q("default")})},children:O.following?e(x,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(x,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(De,{})]}),e(Zn,{className:"plain",children:"Filters"}),e(ae,{type:"checkbox",checked:!!c,onClick:()=>{c?h.delete("media"):h.set("media","1"),l(h)},children:[e(w,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(De,{}),e(Bs,{className:"menu-field",disabled:D,children:({ref:A})=>e("form",{onSubmit:_=>{var K,z;_.preventDefault();const M=(z=(K=_.target[0].value)==null?void 0:K.trim)==null?void 0:z.call(K);M&&!i.some(ee=>ee.toLowerCase()===M.toLowerCase())&&(i.push(M),i.sort(),location.hash=r?`/${r}/t/${i.join("+")}`:`/t/${i.join("+")}${d}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:A,type:"text",placeholder:D?`Max ${$n} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:D})]})}),e(qs,{takeOverflow:!0,children:i.map((A,_)=>e(ae,{disabled:i.length===1,onClick:M=>{i.splice(_,1),i.sort(),location.hash=r?`/${r}/t/${i.join("+")}${d}`:`/t/${i.join("+")}${d}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),A]})]},A))}),e(De,{}),e(ae,{disabled:!m,onClick:()=>{if(S.shortcuts.length>=et){alert(`Max ${et} shortcuts reached. Unable to add shortcut.`);return}const A={type:"hashtag",hashtag:i.join(" "),instance:r,media:c?"on":void 0};S.shortcuts.some(M=>M.type===A.type&&M.hashtag.split(/[\s+]+/).sort().join(" ")===A.hashtag.split(/[\s+]+/).sort().join(" ")&&(M.instance?M.instance===A.instance:!0)&&(M.media?!!M.media==!!A.media:!0))?alert("This shortcut already exists"):(S.shortcuts.push(A),fe("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(ae,{onClick:()=>{let A=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(A)){A&&alert("Invalid instance");return}A&&(A=A.toLowerCase().trim(),location.hash=`/${A}/t/${i.join("+")}${d}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),g!==r&&e(ae,{onClick:()=>{location.hash=`/${g}/t/${i.join("+")}${d}`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:g}),")"]})]})]})},r+I)}const So=20;function ds(t){var m;const n=me(S),{masto:s,instance:o}=B(),a=(t==null?void 0:t.id)||((m=it())==null?void 0:m.id),i=U(),h=U();async function l(I){(I||!h.current)&&(h.current=s.v1.timelines.list.$select(a).list({limit:So}));const b=await h.current.next();let{value:y}=b;return y!=null&&y.length&&(I&&(i.current=y[0].id),y.forEach(k=>{$e(k,o)})),{...b,value:y}}async function c(){try{const I=await s.v1.timelines.list.$select(a).list({limit:1,since_id:i.current});let{value:b}=I;return b=dt(b,"home"),!!(b!=null&&b.length)}catch{return!1}}const[d,u]=C({title:"List"});_e(d.title,"/l/:id"),H(()=>{(async()=>{try{const I=await s.v1.lists.$select(a).fetch();u(I)}catch{}})()},[a]);const[r,p]=C(!1),[f,g]=C(!1);return e(x,{children:[e(Xe,{title:d.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:l,checkForUpdates:c,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:e(J,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(He,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ae,{onClick:()=>p({list:d}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(ae,{onClick:()=>g(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},a),r&&e(ye,{class:"light",onClick:I=>{I.target===I.currentTarget&&p(!1)},children:e(Zt,{list:r==null?void 0:r.list,onClose:I=>{I.state==="success"&&I.list?u(I.list):I.state==="deleted"&&(location.hash="/l"),p(!1)}})}),f&&e(ye,{class:"light",onClick:I=>{I.target===I.currentTarget&&g(!1)},children:e(Io,{listID:a,onClose:()=>g(!1)})})]})}const ko=40;function Io({listID:t,onClose:n}){const{masto:s,instance:o}=B(),[a,i]=C([]),[h,l]=C("default"),[c,d]=C(!1),u=U();async function r(p){d(!1),l("loading"),(async()=>{try{(p||!u.current)&&(u.current=s.v1.lists.$select(t).accounts.list({limit:ko}));const f=await u.current.next();let{done:g,value:m}=f;m!=null&&m.length?(i(p?m:a.concat(m)),d(!g)):d(!1),l("default")}catch{l("error")}})()}return H(()=>{r(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[a.map(p=>e("li",{children:[e(Ke,{account:p,instance:o}),e(To,{account:p,listID:t})]},p.id)),c&&h==="default"&&e(Ze,{as:"li",onChange:p=>p&&r(),children:e("button",{type:"button",class:"light block",onClick:r,children:"Show more…"})})]})})]})}function To({account:t,listID:n}){const{masto:s}=B(),[o,a]=C("default"),[i,h]=C(!1);return e(je,{confirm:!i,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{i?(a("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),a("default"),h(!1)}catch{a("error")}})()):(a("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),a("default"),h(!0)}catch{a("error")}})())},children:e("button",{type:"button",class:`light ${i?"":"danger"}`,disabled:o==="loading",children:i?"Add":"Remove…"})})}const xn=20,Co=new URLSearchParams;function us({columnMode:t,...n}){const{masto:s,instance:o}=B(),[a]=t?[Co]:We(),[i,h]=C(null),l=(n==null?void 0:n.type)||a.get("type")||i;_e(`Mentions${l==="private"?" (Private)":""}`,"/mentions");const c=U(),d=U();async function u(b){(b||!c.current)&&(c.current=s.v1.notifications.list({limit:xn,types:["mention"]}));const y=await c.current.next();let{value:k}=y;return k!=null&&k.length&&(b&&(d.current=k[0].id),k.forEach(({status:v})=>{$e(v,o)})),{...y,value:k==null?void 0:k.map(v=>v.status)}}const r=U(),p=U();async function f(b){(b||!r.current)&&(r.current=s.v1.conversations.list({limit:xn}));const y=await r.current.next();let{value:k}=y;return k=k==null?void 0:k.filter(v=>v.lastStatus),k!=null&&k.length&&(b&&(p.current=k[0].lastStatus.id),k.forEach(({lastStatus:v})=>{$e(v,o)})),{...y,value:k==null?void 0:k.map(v=>v.lastStatus)}}function g(...b){return l==="private"?f(...b):u(...b)}async function m(){if(l==="private")try{const b=await s.v1.conversations.list({limit:1,since_id:p.current}).next();let{value:y}=b;return y!=null&&y.length?(p.current=y[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await s.v1.notifications.list({limit:1,types:["mention"],since_id:d.current}).next();let{value:y}=b;return y!=null&&y.length?(d.current=y[0].id,!0):!1}catch{return!1}}const I=de(()=>e("div",{class:"filter-bar centered",children:[e(J,{to:"/mentions",class:l?"":"is-active",onClick:b=>{t&&(b.preventDefault(),h(null))},children:"All"}),e(J,{to:"/mentions?type=private",class:l==="private"?"is-active":"",onClick:b=>{t&&(b.preventDefault(),h("private"))},children:"Private"})]}),[l]);return e(Xe,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:g,checkForUpdates:m,useItemID:!0,timelineStart:I,refresh:l})}const $o={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function xo(t){return t.filter(n=>{const{type:s,id:o,createdAt:a}=n;if(!s)return!1;const i=$o[s];return i!=null&&i.length?i.every(h=>!!n[h]):!0})}function hs(t){t=xo(t);const n={},s=[];for(let i=0,h=0;i<t.length;i++){const l=t[i],{id:c,status:d,account:u,type:r,createdAt:p}=l,f=p?new Date(p).toLocaleDateString():"";let g=r;(r==="favourite"||r==="reblog")&&(g="favourite+reblog");const m=`${d==null?void 0:d.id}-${g}-${f}`,I=n[m];if(g==="follow_request")s[h++]=l;else if(I!=null&&I.account){const b=I._accounts.find(y=>y.id===u.id);b?(b._types.push(r),b._types.sort().reverse(),I.id+=`-${c}`):(u._types=[r],I._accounts.push(u),I.id+=`-${c}`)}else{u._types=[r];let b=n[m]={...l,type:g,_accounts:[u]};s[h++]=b}}const o={},a=[];for(let i=0,h=0;i<s.length;i++){const l=s[i],{id:c,account:d,_accounts:u,type:r,createdAt:p}=l,f=p?new Date(p).toLocaleDateString():"";if(r==="favourite+reblog"&&d&&u.length===1){const g=`${d==null?void 0:d.id}-${r}-${f}`,m=o[g];if(m)m._statuses.push(l.status),m.id+=`-${c}`;else{let I=o[g]={...l,type:r,_statuses:[l.status]};a[h++]=I}}else a[h++]=l}return a}const Ao=30,Lo=new URLSearchParams;function Mo({columnMode:t}){_e("Notifications","/notifications");const{masto:n,instance:s}=B(),o=me(S),[a,i]=C("default"),[h]=t?[Lo]:We(),l=h.get("id"),c=h.get("access_token"),[d,u]=C(!1),[r,p]=C(!1),f=U(),{nearReachEnd:g,scrollDirection:m,reachStart:I,nearReachStart:b}=to({scrollableRef:f}),y=m==="end"&&!b,[k,v]=C([]),[T,$]=C([]),L=U();async function q(P){(P||!L.current)&&(L.current=n.v1.notifications.list({limit:Ao,excludeTypes:["follow_request"]}));const W=await L.current.next(),X=W.value;if(X!=null&&X.length){X.forEach(be=>{$e(be.status,s,{skipThreading:!0})});const re=hs(X);P?(S.notificationsLast=X[0],S.notifications=re,n.v1.markers.create({notifications:{lastReadId:X[0].id}}).catch(()=>{})):S.notifications.push(...re)}return S.notificationsShowNew=!1,S.notificationsLastFetchTime=Date.now(),W}async function O(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const E=()=>{i("loading"),(async()=>{try{const P=await O();v(P),i("default")}catch{i("error")}})()};async function D(){try{return await n.v1.announcements.list()}catch{return[]}}const A=P=>{M(!1),i("loading"),(async()=>{try{const W=q(P);P&&(D().then(re=>{re.sort((be,ve)=>{const Se=new Date(be.updatedAt||be.createdAt);return new Date(ve.updatedAt||ve.createdAt)-Se}),$(re)}).catch(()=>{}),O().then(re=>{v(re)}).catch(()=>{}));const{done:X}=await W;u(!X),i("default")}catch{i("error")}})()};H(()=>{A(!0)},[]),H(()=>{I&&A(!0)},[I]);const[_,M]=C(!1),K=Ge(({disableIdleCheck:P=!1}={})=>{var W;a!=="loading"&&o.settings.autoRefresh&&((W=f.current)==null?void 0:W.scrollTop)<16&&(P||window.__IDLE__)&&!Ro()&&A(!0)},[o.notificationsShowNew,o.settings.autoRefresh,a]),z=U();lt(P=>{let W;if(P){const X=Date.now()-z.current;!z.current||X>1e3*3?K({disableIdleCheck:!0}):z.current=Date.now(),W=Hs(S,"notificationsShowNew",re=>{re&&K(),M(re)})}return()=>{W==null||W()}});const ee=new Date,Q=new Date(ee-24*60*60*1e3);let pe=new Date;const ge=!o.notifications.some(P=>new Date(P.createdAt).toDateString()===ee.toDateString()),Y=U();return H(()=>{l&&(S.routeNotification={id:l,accessToken:atob(c)})},[l,c]),e("div",{id:"notifications-page",class:"deck-container",ref:f,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${r?"only-mentions":""}`,children:[e("header",{hidden:y,onClick:P=>{var W;P.target.closest("a, button")||(W=f.current)==null||W.scrollTo({top:0,behavior:"smooth"})},onDblClick:P=>{P.target.closest("a, button")||A(!0)},class:a==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),e(J,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),_&&a!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var P;A(!0),(P=f.current)==null||P.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),T.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",T.length>1?"s":""]})," ",e("small",{class:"insignificant",children:s})]}),T.length>1&&e("span",{class:"announcements-nav-buttons",children:T.map((P,W)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var X;(X=Y.current)==null||X.children[W].scrollIntoView({behavior:"smooth",block:"nearest"})},children:W+1}))})]}),e("ul",{class:`announcements-list-${T.length>1?"multiple":"single"}`,ref:Y,children:T.map(P=>e("li",{children:e(_o,{announcement:P})}))})]})})}),k.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),k.length>5?e("details",{children:[e("summary",{children:[k.length," follow requests"]}),e("ul",{children:k.map(P=>e("li",{children:[e(Ke,{account:P}),e(qt,{accountID:P.id,onChange:()=>{}})]},P.id))})]}):e("ul",{children:k.map(P=>e("li",{children:[e(Ke,{account:P}),e(qt,{accountID:P.id,onChange:()=>{}})]},P.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:r,onChange:P=>{p(P.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),ge&&!!o.notifications.length&&e("p",{class:"ui-state insignificant",children:a==="default"?"You're all caught up.":e(x,{children:"…"})}),o.notifications.length?e(x,{children:o.notifications.filter(P=>P.type!=="follow_request").map(P=>{if(r&&P.type!=="mention")return null;const W=new Date(P.createdAt),X=W.toDateString()!==pe.toDateString();X&&(pe=W);const re=W.toDateString()===Q.toDateString()?"Yesterday":Qe(pe,{hideTime:!0});return e(x,{children:[X&&e("h2",{class:"timeline-header",children:re}),e(Xt,{instance:s,notification:P},P.id)]},P.id)})}):e(x,{children:[a==="loading"&&e(x,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((P,W)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),a==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>A(!0),children:"Try again"})]})]}),d&&e(Ze,{onChange:P=>{P&&A()},children:e("button",{type:"button",class:"plain block",disabled:a==="loading",onClick:()=>A(),style:{marginBlockEnd:"6em"},children:a==="loading"?e(we,{abrupt:!0}):e(x,{children:"Show more…"})})})]})})}function Ro(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function _o({announcement:t}){const{instance:n}=B(),{contact:s}=Ls(),o=s==null?void 0:s.account,{id:a,content:i,startsAt:h,endsAt:l,published:c,allDay:d,publishedAt:u,updatedAt:r,read:p,mentions:f,statuses:g,tags:m,emojis:I,reactions:b}=t,y=new Date(u),k=Qe(y),v=new Date(r),T=Qe(v);return e("div",{class:"announcement-block",children:[e(Ke,{account:o}),e("div",{class:"announcement-content",onClick:Fn({mentions:f,instance:n}),dangerouslySetInnerHTML:{__html:Ft(i,{emojis:I})}}),e("p",{class:"insignificant",children:[e("time",{datetime:y.toISOString(),children:Qe(y)}),r&&T!==k&&e(x,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:v.toISOString(),children:Qe(v)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:b.map($=>{const{name:L,count:q,me:O,staticUrl:E,url:D}=$;return e("button",{type:"button",class:`plain4 small ${O?"reacted":""}`,children:[D||E?e("img",{src:D||E,alt:L,width:"16",height:"16"}):e("span",{children:L})," ",e("span",{class:"count",children:ze(q)})]})})})]})}const fs=Be(Mo),Eo=20;function Ht({local:t,columnMode:n,...s}){const o=me(S),a=!!t,i=n?{}:it(),{masto:h,instance:l}=B({instance:(s==null?void 0:s.instance)||i.instance}),{masto:c,instance:d}=B(),u=`${a?"Local":"Federated"} timeline (${l})`;_e(u,a?"/:instance?/p/l":"/:instance?/p");const r=U(),p=U();async function f(m){(m||!p.current)&&(p.current=h.v1.timelines.public.list({limit:Eo,local:a}));const I=await p.current.next();let{value:b}=I;return b!=null&&b.length&&(m&&(r.current=b[0].id),b.forEach(y=>{$e(y,l)})),{...I,value:b}}async function g(){try{const m=await h.v1.timelines.public.list({limit:1,local:a,since_id:r.current}).next();let{value:I}=m;return I=dt(I,"public"),!!(I!=null&&I.length)}catch{return!1}}return e(Xe,{title:u,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:a?"Local timeline":"Federated timeline"}),e("div",{children:l})]}),id:"public",instance:l,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:g,useItemID:!0,headerStart:e(x,{}),boostsCarousel:o.settings.boostsCarousel,filterContext:"public",headerEnd:e(He,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ae,{href:a?`/#/${l}/p`:`/#/${l}/p/l`,children:a?e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(De,{}),e(ae,{onClick:()=>{let m=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(m)){m&&alert("Invalid instance");return}m&&(m=m.toLowerCase().trim(),location.hash=a?`/${m}/p/l`:`/${m}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),d!==l&&e(ae,{onClick:()=>{location.hash=a?`/${d}/p/l`:`/${d}/p`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:d}),")"]})]})]})},l+a)}const vt=5,Ut=40,Po=new URLSearchParams;function ps({columnMode:t,...n}){const s=t?{}:it(),{masto:o,instance:a,authenticated:i}=B({instance:s.instance}),[h,l]=C("default"),[c]=t?[Po]:We(),d=U(),u=(n==null?void 0:n.query)||c.get("q"),r=t?"statuses":(n==null?void 0:n.type)||c.get("type");_e(u?`Search: ${u}${r?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[r]})`:""}`:"Search","/search");const[p,f]=C(!1),g=U(0);H(()=>{g.current=0},[u,r]);const m=U();Je(()=>{var _,M;(M=(_=m.current)==null?void 0:_.scrollTo)==null||M.call(_,0,0)},[u,r]);const[I,b]=C([]),[y,k]=C([]),[v,T]=C([]);H(()=>{b([]),k([]),T([])},[u]);const $={statuses:b,accounts:k,hashtags:T},[L,q]=C({}),O=async _=>{if(!(_!=null&&_.length))return;const M=await Jt(_,L);M&&q({...L,...M})};function E(_){_&&(g.current=0),!(!_&&!i)&&(l("loading"),_&&!r&&(b(I.slice(0,vt)),k(y.slice(0,vt)),T(v.slice(0,vt))),(async()=>{var K,z;const M={q:u,resolve:i,limit:vt};r&&(M.limit=Ut,M.type=r,i&&(M.offset=g.current));try{const ee=await o.v2.search.fetch(M);if(r)if(_){$[r](ee[r]);const Q=(K=ee[r])==null?void 0:K.length;g.current=Ut,f(!!Q)}else{$[r](pe=>[...pe,...ee[r]]);const Q=(z=ee[r])==null?void 0:z.length;g.current=g.current+Ut,f(!!Q)}else b(ee.statuses||[]),k(ee.accounts||[]),T(ee.hashtags||[]),g.current=0,f(!1);O(ee.accounts),l("default")}catch{l("error")}})())}const D=U();lt(_=>{var K;const M=((K=m.current)==null?void 0:K.scrollTop)===0;if(_&&M){const z=Date.now()-D.current;!D.current||z>1e3*3?E(!0):D.current=Date.now()}}),H(()=>{var _,M,K,z;(M=(_=d.current)==null?void 0:_.setValue)==null||M.call(_,u||""),u?E(!0):(z=(K=d.current)==null?void 0:K.focus)==null||z.call(K)},[u,r,a]),Me(["/","Slash"],_=>{var M,K;(K=(M=d.current)==null?void 0:M.focus)==null||K.call(M)},{preventDefault:!0});const[A]=jt();return e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:h==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(bt,{})}),e(as,{ref:d}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{E(!0)},disabled:h==="loading",children:e(w,{icon:"search",size:"l"})})})]})}),e("main",{children:[!!u&&!t&&e("div",{ref:A,class:`filter-bar ${h==="loading"?"loading":""}`,children:[!!r&&e(J,{to:`/search${u?`?q=${encodeURIComponent(u)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(u)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(u)}&type=statuses`}].sort((_,M)=>_.type===r?-1:M.type===r?1:0).map(_=>e(J,{to:_.to,children:_.label},_.type))]}),u?e(x,{children:[(!r||r==="accounts")&&e(x,{children:[r!=="accounts"&&e("h2",{class:"timeline-header",children:["Accounts"," ",e(J,{to:`/search?q=${encodeURIComponent(u)}&type=accounts`,children:e(w,{icon:"arrow-right",size:"l"})})]}),y.length>0?e(x,{children:[e("ul",{class:"timeline flat accounts-list",children:y.map(_=>e("li",{children:e(Ke,{account:_,instance:a,showStats:!0,relationship:L[_.id]})},_.id))}),r!=="accounts"&&e("div",{class:"ui-state",children:e(J,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!r&&(h==="loading"?e("p",{class:"ui-state",children:e(we,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!r||r==="hashtags")&&e(x,{children:[r!=="hashtags"&&e("h2",{class:"timeline-header",children:["Hashtags"," ",e(J,{to:`/search?q=${encodeURIComponent(u)}&type=hashtags`,children:e(w,{icon:"arrow-right",size:"l"})})]}),v.length>0?e(x,{children:[e("ul",{class:"link-list hashtag-list",children:v.map(_=>{var ee;const{name:M,history:K}=_,z=(ee=K==null?void 0:K.reduce)==null?void 0:ee.call(K,(Q,pe)=>Q+ +pe.uses,0);return e("li",{children:e(J,{to:a?`/${a}/t/${M}`:`/t/${M}`,children:[e(w,{icon:"hashtag"}),e("span",{children:M}),!!z&&e("span",{class:"count",children:ze(z)})]})},`${M}-${z}`)})}),r!=="hashtags"&&e("div",{class:"ui-state",children:e(J,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!r&&(h==="loading"?e("p",{class:"ui-state",children:e(we,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!r||r==="statuses")&&e(x,{children:[r!=="statuses"&&e("h2",{class:"timeline-header",children:["Posts"," ",e(J,{to:`/search?q=${encodeURIComponent(u)}&type=statuses`,children:e(w,{icon:"arrow-right",size:"l"})})]}),I.length>0?e(x,{children:[e("ul",{class:"timeline",children:I.map(_=>e("li",{children:e(J,{class:"status-link",to:a?`/${a}/s/${_.id}`:`/s/${_.id}`,children:e(Le,{status:_})})},_.id))}),r!=="statuses"&&e("div",{class:"ui-state",children:e(J,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!r&&(h==="loading"?e("p",{class:"ui-state",children:e(we,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!r&&(h==="default"?p?e(Ze,{onChange:_=>{_&&E()},children:e("button",{type:"button",class:"plain block",onClick:()=>E(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):h==="loading"&&e("p",{class:"ui-state",children:e(we,{abrupt:!0})}))]}):h==="loading"?e("p",{class:"ui-state",children:e(we,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const Do=20,No=tt(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function ms({columnMode:t,...n}){const s=me(S),o=t?{}:it(),{masto:a,instance:i}=B({instance:(n==null?void 0:n.instance)||o.instance}),{masto:h,instance:l}=B(),c=`Trending (${i})`;_e(c,"/:instance?/trending");const d=U(),[u,r]=C([]),[p,f]=C([]),g=U();async function m(y){var T;if(y||!g.current){g.current=a.v1.trends.statuses.list({limit:Do});try{const $=a.v1.trends.tags.list(),{value:L}=await $.next();L!=null&&L.length&&r(L)}catch{}try{const{value:$}=await No(a),L=(T=$==null?void 0:$.filter)==null?void 0:T.call($,q=>q.type==="link");L!=null&&L.length&&f(L)}catch{}}const k=await g.current.next();let{value:v}=k;return v!=null&&v.length&&(y&&(d.current=v[0].id),v.forEach($=>{$e($,i)})),{...k,value:v}}async function I(){try{const y=await a.v1.trends.statuses.list({limit:1}).next();let{value:k}=y;return k=dt(k,"public"),k!=null&&k.length&&k[0].id!==d.current?(d.current=k[0].id,!0):!1}catch{return!1}}const b=de(()=>e(x,{children:[!!u.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),u.map((y,k)=>{const{name:v,history:T}=y,$=T.reduce((L,q)=>L+ +q.uses,0);return e(J,{to:`/${i}/t/${v}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),v]}),e("span",{class:"filter-count",children:ze($)})]},v)})]}),!!p.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),p.map(y=>{const{authorName:k,authorUrl:v,blurhash:T,description:$,height:L,image:q,imageDescription:O,language:E,providerName:D,providerUrl:A,publishedAt:_,title:M,url:K,width:z}=y,ee=new URL(K).hostname.replace(/^www\./,"").replace(/\/$/,"");let Q;if(T){const pe=jn(T),ge=ns(pe);Q=ss([.6,ge[1],ge[2]])}return e("a",{href:K,target:"_blank",rel:"noopener noreferrer",style:Q?{"--accent-color":`rgb(${Q.join(",")})`,"--accent-alpha-color":`rgba(${Q.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:q,alt:O,width:z,height:L,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:ee})," ",!!_&&e(x,{children:"· "}),!!_&&e(x,{children:e(Lt,{datetime:_,format:"micro"})})]}),!!M&&e("h1",{class:"title",lang:E,dir:"auto",children:M})]}),!!$&&e("p",{class:"description",lang:E,dir:"auto",children:$})]})]})},K)})]})]}),[u,p]);return e(Xe,{title:c,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:i})]}),id:"trending",instance:i,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:I,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(x,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",timelineStart:b,headerEnd:e(He,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(ae,{onClick:()=>{let y=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(y)){y&&alert("Invalid instance");return}y&&(y=y.toLowerCase().trim(),location.hash=`/${y}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),l!==i&&e(ae,{onClick:()=>{location.hash=`/${l}/trending`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:l}),")"]})]})]})},i)}function Uo(){_e("Home","/");const t=me(S),{shortcuts:n}=t,s=n.map(o=>{if(!o)return null;const{type:a,...i}=o,h={following:en,notifications:fs,list:ds,public:Ht,bookmarks:cs,favourites:rs,hashtag:ls,mentions:us,trending:ms,search:ps}[a];return!h||a==="search"&&!i.query?null:e(h,{...i,columnMode:!0},a+JSON.stringify(i))});return Me(["1","2","3","4","5","6","7","8","9"],(o,a)=>{try{const i=parseInt(a.keys[0],10)-1;document.querySelectorAll("#columns > *")[i].focus()}catch{}}),e("div",{id:"columns",onContextMenu:o=>{o.target.closest(".deck > header")&&!o.target.closest("a")&&!o.target.closest("button")&&(o.preventDefault(),S.showShortcutsSettings=!0)},children:s})}function Fo(){var n;const t=me(S);return H(()=>{(async()=>{const s=await pt.drafts.keys();if(s.length){const o=Bn();s.filter(i=>i.startsWith(o)).length&&(S.showDrafts=!0)}})()},[]),e(x,{children:(t.settings.shortcutsViewMode==="multi-column"||!t.settings.shortcutsViewMode&&t.settings.shortcutsColumnsMode)&&((n=t.shortcuts)!=null&&n.length)?e(Uo,{}):e(en,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(Oo,{})})})}function Oo(){const t=me(S),n=U(),[s,o]=C(void 0);return e(x,{children:[e(J,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${s||""}`,onClick:a=>{a.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(a.preventDefault(),o(i=>i?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(qo,{state:s,anchorRef:n,onClose:()=>o(void 0)})]})}const zo=30,Bo=5;function qo({anchorRef:t,state:n,onClose:s}){const{masto:o,instance:a}=B(),i=me(S),[h,l]=C("default"),c=o.v1.notifications.list({limit:zo});async function d(){const g=await c.next(),m=g.value;if(m!=null&&m.length){m.forEach(b=>{$e(b.status,a,{skipThreading:!0})});const I=hs(m);S.notificationsLast=m[0],S.notifications=I,o.v1.markers.create({notifications:{lastReadId:m[0].id}}).catch(()=>{})}return S.notificationsShowNew=!1,S.notificationsLastFetchTime=Date.now(),g}const[u,r]=C(!1);function p(){return o.v1.followRequests.list({limit:1})}function f(){l("loading"),(async()=>{try{await d();const g=await p();r(!!(g!=null&&g.length)),l("default")}catch{l("error")}})()}return H(()=>{n==="open"&&f()},[n]),e(Kn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:s,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:i.notifications.length?e(x,{children:i.notifications.slice(0,Bo).map(g=>e(Xt,{instance:a,notification:g,disableContextMenu:!0},g.id))}):h==="loading"?e("div",{class:"ui-state",children:e(we,{abrupt:!0})}):h==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:f,children:"Try again"})})]})}),e("footer",{children:[e(J,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(J,{to:"/notifications",class:"button plain2",children:[u?e(x,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const Ho=Be(Fo),Vo=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function gs(t){const{hostname:n,pathname:s}=new URL(t);for(const o of Vo){const[,a]=s.match(o)||[];if(a)return{instance:n,id:a}}return{}}function Go(t){const{instance:n,id:s}=gs(t);return n&&s?`/${n}/s/${s}`:null}function jo(){const n=ut().pathname.replace(/^\//,""),s=gs(n),o=s!=null&&s.instance?`/${s.instance}/s/${s.id}`:null,[a,i]=C("loading");return Je(()=>{i("loading"),(async()=>{try{const{instance:h,id:l}=s,{masto:c}=B({instance:h});if(await c.v1.statuses.$select(l).fetch()){window.location.hash=o+"?view=full";return}}catch{}{const{masto:h,instance:l}=B(),c=await h.v2.search.fetch({q:n,limit:1,resolve:!0});if(c.statuses.length){const d=c.statuses[0];window.location.hash=`/${l}/s/${d.id}?view=full`}else if(c.accounts.length){const d=c.accounts[0];window.location.hash=`/${l}/a/${d.id}`}else o?window.location.hash=o+"?view=full":i("error")}})()},[o]),e("div",{class:"ui-state",tabIndex:"-1",children:[a==="loading"?e(x,{children:[e(we,{abrupt:!0}),e("h2",{children:"Resolving…"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):e(x,{children:[e("h2",{children:"Unable to resolve URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(J,{to:"/",children:"Go home"})})]})}function Yo(){const{masto:t}=B();_e("Lists","/l");const[n,s]=C("default"),[o,a]=Mt(d=>d+1,0),[i,h]=C([]);H(()=>{s("loading"),(async()=>{try{const d=await t.v1.lists.list();d.sort((u,r)=>u.title.localeCompare(r.title)),h(d),s("default")}catch{s("error")}})()},[o]);const[l,c]=C(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),e(J,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>c(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:i.length>0?e(x,{children:[e("ul",{class:"link-list",children:i.map(d=>e("li",{children:e(J,{to:`/l/${d.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:d.title})]})})}))}),i.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[i.length," list",i.length===1?"":"s"]})})]}):n==="loading"?e("p",{class:"ui-state",children:e(we,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),l&&e(ye,{class:"light",onClick:d=>{d.target===d.currentTarget&&c(!1)},children:e(Zt,{list:l==null?void 0:l.list,onClose:d=>{d.state==="success"&&a(),c(!1)}})})]})}const Wo=""+new URL("instances-MzK7fGXv.json",import.meta.url).href;var Ko={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:Zo,PHANPY_WEBSITE:Jo}=Ko,tn="read write follow push";async function Xo({instanceURL:t}){const n=new URLSearchParams({client_name:Zo,redirect_uris:location.origin+location.pathname,scopes:tn,website:Jo});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Qo({instanceURL:t,client_id:n}){const s=new URLSearchParams({client_id:n,scope:tn,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${s.toString()}`}async function ea({instanceURL:t,client_id:n,client_secret:s,code:o}){const a=new URLSearchParams({client_id:n,client_secret:s,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:tn});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()})).json()}var ta={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:na}=ta;function sa(){_e("Log in");const t=U(),n=se.local.get("instanceURL"),[s,o]=C("default"),[a]=We(),i=a.get("instance"),h=a.get("submit"),[l,c]=C(i||(n==null?void 0:n.toLowerCase())||""),[d,u]=C([]);H(()=>{(async()=>{try{const y=await(await fetch(Wo)).json();u(y)}catch{}})()},[]);const r=b=>{b&&(se.local.set("instanceURL",b),(async()=>{o("loading");try{const{client_id:y,client_secret:k,vapid_key:v}=await Xo({instanceURL:b});y&&k?(se.session.set("clientID",y),se.session.set("clientSecret",k),se.session.set("vapidKey",v),location.href=await Qo({instanceURL:b,client_id:y})):alert("Failed to register application"),o("default")}catch{o("error")}})())},p=l?l.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,f=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(p)&&!/[\s\/\\@]/.test(p),g=p?d.filter(b=>b.includes(l)).sort((b,y)=>{const k=b.toLowerCase().startsWith(l.toLowerCase()),v=y.toLowerCase().startsWith(l.toLowerCase());return k&&!v?-1:!k&&v?1:0}).slice(0,10):[],m=f?p:g!=null&&g.length?g[0]:l?d.find(b=>b.includes(l)):null,I=b=>{b.preventDefault(),r(m)};return h&&H(()=>{r(i||m)},[]),e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:I,children:[e("h1",{children:[e("img",{src:Wt,alt:"",width:"80",height:"80"}),e("br",{}),"Log in"]}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:l,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:s==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:b=>{c(b.target.value)}}),(g==null?void 0:g.length)>0?e("ul",{id:"instances-suggestions",children:g.map((b,y)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{r(b)},children:b})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),s==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{disabled:s==="loading"||!l||!m,children:m?`Continue with ${m}`:"Continue"})," "]}),e(we,{hidden:s!=="loading"}),e("hr",{}),!na&&e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(J,{to:"/",children:"Go home"})})]})})}const St=40,ia=10,oa=5;let Vt={},It={},Tt={};function Ct(t){delete It[t],delete Tt[t]}const ht={block:"nearest",inline:"center",behavior:"smooth"},An=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",Ln=/\/s\//i;function aa(t){const{id:n}=t,{masto:s,instance:o}=B({instance:t.instance}),a=me(S),[i,h]=We(),l=i.get("media"),c=i.get("media-only"),d=parseInt(l||c,10);let u=d>0;const r=i.get("mediaStatusID"),p=Gn(r,o);r&&!p&&(u=!1);const f=u&&!!c,g=Ye(n,o),[m,I]=C(S.statuses[g]);H(()=>{S.statuses[g]&&I(S.statuses[g])},[g]);const b=de(()=>{const{prevLocation:v}=S,T=((v==null?void 0:v.pathname)||"")+((v==null?void 0:v.search)||""),$=gt("/:instance/s/:id",T)||gt("/s/:id",T);return!T||$?"/":T},[]);H(()=>{!m&&u&&(async()=>{try{const v=await s.v1.statuses.$select(n).fetch();$e(v,o),I(v)}catch{alert("Unable to load post."),location.hash=b}})()},[u]);const y=r?p==null?void 0:p.mediaAttachments:m==null?void 0:m.mediaAttachments,k=Ge(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&a.prevLocation?history.back():f?location.hash=b:(i.delete("media"),i.delete("mediaStatusID"),h(i))},[f,b,a.prevLocation]);return H(()=>{let v=setTimeout(()=>{const T=document.querySelector(".carousel");T&&T.focus()},100);return()=>clearTimeout(v)},[f]),e("div",{class:"deck-backdrop",children:[u?y!=null&&y.length?e(is,{mediaAttachments:y,statusID:r||n,instance:o,lang:m==null?void 0:m.language,index:d-1,onClose:k}):e("div",{class:"media-modal-container loading",children:e(we,{abrupt:!0})}):e(J,{to:b}),!f&&e(ra,{id:n,instance:t.instance,closeLink:b})]})}function ca(t){const{linkable:n,to:s,onClick:o,...a}=t;return n?e(J,{class:"status-link",to:s,onClick:o,...a}):e("div",{class:"status-focus",tabIndex:0,...a})}function ra({id:t,closeLink:n="/",instance:s}){var Ae,Pe;const[o,a]=We(),i=o.get("media"),h=o.get("mediaStatusID"),l=parseInt(i,10)>0,c=U(!S.prevLocation&&(history.length===1||"navigation"in window&&((Pe=(Ae=navigation==null?void 0:navigation.entries)==null?void 0:Ae.call(navigation))==null?void 0:Pe.length)===1)),[d,u]=C(o.get("view")||c.current?"full":null),r=!!parseInt(o.get("translate")),{masto:p,instance:f}=B({instance:s}),{masto:g,instance:m,authenticated:I}=B(),b=f===m,y=me(S),[k,v]=C([]),[T,$]=C("default"),L=U(),q=Ye(t,f),O=U(0),E=U();H(()=>{var R;(R=E.current)==null||R.focus()},[]),H(()=>{var j;const R=Jn(()=>{if(!E.current)return;const{scrollTop:Z}=E.current;T!=="loading"&&(Tt[t]=Z)},50);return(j=E.current)==null||j.addEventListener("scroll",R,{passive:!0}),R(),()=>{var Z;R.cancel(),(Z=E.current)==null||Z.removeEventListener("scroll",R)}},[t,T!=="loading"]);const D=U(),A=U(),_=({reloadHero:R}={})=>{$("loading");let j;const Z=It[t];if(Z){const N=Z.filter(oe=>S.statuses[q]);v(N)}else v([{id:t}]);return(async()=>{var Ne,Ue;const N=()=>un(()=>p.v1.statuses.$select(t).fetch(),{retries:4}),oe=un(()=>p.v1.statuses.$select(t).context.fetch(),{retries:8}),he=!!y.statuses[q];let ce=y.statuses[q];if(!(he&&!R))try{ce=await N(),$e(ce,f),await new Promise(Ce=>{setTimeout(Ce,100)})}catch{$("error");return}try{let Ce=function(ne){return ne==null?void 0:ne.map(Re=>({id:Re.id,account:Re.account,repliesCount:Re.repliesCount,content:Re.content,weight:mt(Re),replies:Ce(Re.__replies)}))};const Fe=await oe,{ancestors:Ve,descendants:Ie}=Fe;O.current=(Ie==null?void 0:Ie.length)||0;const qe=new Set;Ve.forEach(ne=>{$e(ne,f,{skipThreading:!0}),ne.inReplyToId&&!Ve.find(Re=>Re.id===ne.inReplyToId)&&qe.add(ne.inReplyToId)});const ot=Ve.every(ne=>ne.account.id===ce.account.id),Oe=[];Ie.forEach(ne=>{if($e(ne,f,{skipThreading:!0}),ne.inReplyToId&&!Ie.find(Re=>Re.id===ne.inReplyToId)&&ne.inReplyToId!==ce.id&&qe.add(ne.inReplyToId),ne.inReplyToAccountId===ne.account.id)Oe.push(ne);else if(ne.inReplyToId===ce.id)Oe.push(ne);else if(!ne.inReplyToAccountId&&Oe.find(Re=>Re.id===ne.inReplyToId)&&ne.account.id===ce.account.id)Oe.push(ne);else{const Re=Ie.find(ys=>ys.id===ne.inReplyToId);Re&&(Re.__replies||(Re.__replies=[]),Re.__replies.push(ne))}}),qe.size;const _t=[...Ve.map(ne=>({id:ne.id,ancestor:!0,isThread:ot,accountID:ne.account.id,account:ne.account,repliesCount:ne.repliesCount,weight:mt(ne)})),{id:t,accountID:ce.account.id,weight:mt(ce)},...Oe.map(ne=>({id:ne.id,account:ne.account,accountID:ne.account.id,descendant:!0,thread:ne.account.id===ce.account.id,weight:mt(ne),replies:Ce(ne.__replies)}))];$("default"),D.current={offsetTop:(Ne=L.current)==null?void 0:Ne.offsetTop,scrollTop:(Ue=E.current)==null?void 0:Ue.scrollTop};const nn=_t.findIndex(ne=>ne.id===t);nn>=Y&&P(nn+1),v(_t),It[t]=_t,Ms(ce,f)}catch{$("error")}})(),A.current=Date.now(),()=>{clearTimeout(j)}};H(_,[t,p]);const[M,K]=C(!1);H(()=>{let R=setInterval(()=>{const j=Date.now();A.current&&j-A.current>=6e4&&K(!0)},6e4);return()=>{clearInterval(R)}},[]),Je(()=>{var j,Z;if(!k.length)return;const R=Tt[t];if(R)E.current.scrollTop=R;else if(D.current){const N={offsetTop:(j=L.current)==null?void 0:j.offsetTop,scrollTop:(Z=E.current)==null?void 0:Z.scrollTop},oe=N.offsetTop-D.current.offsetTop+N.scrollTop;E.current.scrollTop=oe}else k.length===1&&(E.current.scrollTop=0);D.current=null},[k]),H(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:R}=rt(),j=`https://${R}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(j,{ignoreVary:!0}),_({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),H(()=>()=>{Tt={},S.reloadStatusPage=0,It={},Vt={},Gt.clear()},[]);const z=y.statuses[q]||y.statuses[t],ee=de(()=>{if(!z)return"";const{account:R}=z,j=document.createElement("div");return j.innerHTML=R.displayName,j.innerText.trim()},[z]),Q=de(()=>{if(!z)return"";let R=Vn(z);return R.length>64&&(R=R.slice(0,64)+"…"),R},[z]);_e(ee&&Q?`${ee}: "${Q}"`:"Status","/:instance?/s/:id");const pe=de(()=>{if(!z)return;const{url:R}=z;if(R)return new URL(R).hostname},[z]),ge=de(()=>{if(pe)return pe===f},[pe,f]),[Y,P]=C(St),W=de(()=>k.length-Y,[k.length,Y]),X=k.some(R=>R.descendant),re=k.filter(R=>R.ancestor),[be,ve]=C(!0),Se=de(()=>{if(!L.current||be)return null;const{top:R}=L.current.getBoundingClientRect();return R>0?"down":"up"},[be]);Me("esc",()=>{location.hash=n},{enabled:!l,ignoreEventWhen:R=>!!document.querySelector("#modal-container > *")}),Me("backspace",()=>{location.hash=n}),Me("j",()=>{const R=document.activeElement.closest(".status-link, .status-focus"),j=R==null?void 0:R.getBoundingClientRect(),Z=Array.from(E.current.querySelectorAll(An));if(R&&j.top<E.current.clientHeight&&j.bottom>0){const N=Z.indexOf(R);let oe=Z[N+1];oe&&(oe.focus(),oe.scrollIntoView(ht))}else{const N=Z.find(oe=>{const he=oe.getBoundingClientRect();return he.top>=44&&he.left>=0});N&&(N.focus(),N.scrollIntoView(ht))}}),Me("k",()=>{const R=document.activeElement.closest(".status-link, .status-focus"),j=R==null?void 0:R.getBoundingClientRect(),Z=Array.from(E.current.querySelectorAll(An));if(R&&j.top<E.current.clientHeight&&j.bottom>0){const N=Z.indexOf(R);let oe=Z[N-1];oe&&(oe.focus(),oe.scrollIntoView(ht))}else{const N=Z.find(oe=>{const he=oe.getBoundingClientRect();return he.top>=44&&he.left>=0});N&&(N.focus(),N.scrollIntoView(ht))}}),Me("x",()=>{const R=document.activeElement.closest(".status-link, .status-focus");if(R){const j=R.nextElementSibling;j&&j.tagName.toLowerCase()==="details"&&(j.open=!j.open)}});const[xe,V]=C(!1),te=U(l?"media+status":"status"),F=Ge((R,j,Z,N)=>{R.preventDefault(),R.stopPropagation(),a({media:j+1,mediaStatusID:N.id})},[t]),ie=Ge((R,j)=>{Ct(j.id)},[]);H(()=>{let R;return h&&l&&(R=setTimeout(()=>{var Z;const j=(Z=E.current)==null?void 0:Z.querySelector(`.status-link[href*="/${h}"]`);j&&j.scrollIntoView(ht)},400)),()=>{clearTimeout(R)}},[h,l]);const ue=Ge((R,j)=>{const{id:Z,ancestor:N,isThread:oe,descendant:he,thread:ce,replies:Ne,repliesCount:Ue,weight:Ce}=R,Fe=Z===t;return e("li",{ref:Fe?L:null,class:`${N?"ancestor":""} ${he?"descendant":""} ${ce?"thread":""} ${Fe?"hero":""}`,children:[Fe?e(x,{children:[e(Ze,{threshold:.1,onChange:Ie=>{queueMicrotask(()=>{requestAnimationFrame(()=>{ve(Ie)})})},class:"status-focus",tabIndex:0,children:e(Le,{statusID:Z,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:r})}),T!=="loading"&&!I?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(J,{to:"/login",class:"button",children:"Log in"})]}):!b&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:T==="loading",onClick:()=>{$("loading"),(async()=>{try{const Ie=await g.v2.search.fetch({q:z.url,type:"statuses",resolve:!0,limit:1});if(Ie.statuses.length){const qe=Ie.statuses[0];location.hash=m?`/${m}/s/${qe.id}`:`/s/${qe.id}`}else throw new Error("No results")}catch(Ie){$("default"),alert("Error: "+Ie)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(ca,{linkable:oe||N,to:f?`/${f}/s/${Z}`:`/s/${Z}`,onClick:()=>{Ct(Z)},children:[j===0&&N?e(Ze,{threshold:.5,onChange:Ie=>{queueMicrotask(()=>{requestAnimationFrame(()=>{V(Ie)})})},children:e(Le,{statusID:Z,instance:f,withinContext:!0,size:ce||N?"m":"s",enableTranslate:!0,onMediaClick:F,onStatusLinkClick:ie})}):e(Le,{statusID:Z,instance:f,withinContext:!0,size:ce||N?"m":"s",enableTranslate:!0,onMediaClick:F,onStatusLinkClick:ie,showActionsBar:!!he}),N&&Ue>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:Ue,children:ze(Ue)})]})," "]}),he&&(Ne==null?void 0:Ne.length)>0&&e(bs,{instance:f,replies:Ne,hasParentThread:ce,level:1,accWeight:Ce,openAll:O.current<ia,parentLink:{to:f?`/${f}/s/${Z}`:`/s/${Z}`,onClick:()=>Ct(Z)}}),T==="loading"&&Fe&&!!(z!=null&&z.repliesCount)&&!X&&e("div",{class:"status-loading",children:e(we,{})}),T==="error"&&Fe&&!!(z!=null&&z.repliesCount)&&!X&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{S.reloadStatusPage++},children:"Try again"})]})]},Z)},[t,f,T,I,b,r,F,ie,X]),G=de(()=>{var R;if("navigation"in window&&(navigation!=null&&navigation.entries)){const j=navigation.entries()[navigation.currentEntry.index-1];if(j!=null&&j.url)return Ln.test(j.url)}return Ln.test((R=S.prevLocation)==null?void 0:R.pathname)},[q]),le=de(()=>{if(!W)return[];const R=[];function j(Z){R.push(Z.id),Z.replies&&Z.replies.forEach(j)}return k.slice(Y).forEach(j),R.map(Z=>Ye(Z,f))},[W,k,Y,f]),ke=de(()=>k.slice(0,Y).map(ue),[k,Y,ue]);return e("div",{tabIndex:"-1",ref:E,class:`status-deck deck contained ${k.length>1?"padded-bottom":""} ${te.current==="status"&&!c.current?"slide-in":""} ${d?`deck-view-${d}`:""}`,onAnimationEnd:R=>{te.current==="status"&&(te.current=null)},children:[e("header",{class:`${T==="loading"?"loading":""}`,onDblClick:R=>{S.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[G&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!be&&z&&T!=="loading"?e(x,{children:[e("span",{class:"hero-heading",children:[e($t,{account:z.account,instance:f,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(Lt,{datetime:z.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:R=>{R.preventDefault(),R.stopPropagation(),L.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:Se==="down"?"arrow-down":"arrow-up"})})]}):e(x,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:R=>{R.preventDefault(),R.stopPropagation(),E.current.scrollTo({top:0,behavior:"smooth"})},hidden:!re.length||xe,title:`${re.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),re.filter((R,j,Z)=>Z.findIndex(N=>N.accountID===R.accountID)===j).slice(0,3).map(R=>e(st,{url:R.account.avatar,alt:R.account.displayName},R.account.id)),re.length>3&&e(x,{children:[" ",e("span",{class:"insignificant",children:ze(re.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:d==="full"?"":"none"},onClick:()=>{u(null),o.delete("media"),o.delete("media-only"),o.delete("view"),a(o)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),M&&e("button",{type:"button",class:"plain button-refresh",onClick:()=>{S.reloadStatusPage++,K(!1)},children:e(w,{icon:"refresh",size:"l"})}),e(He,{align:"end",portal:{target:E.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(ae,{disabled:T==="loading",onClick:()=>{S.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(ae,{className:"menu-switch-view",onClick:()=>{u(d==="full"?null:"full"),o.delete("media"),o.delete("media-only"),d==="full"?o.delete("view"):o.set("view","full"),a(o)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[d||""]}),e("span",{children:["Switch to ",d==="full"?"Side Peek":"Full"," view"]})]}),e(ae,{onClick:()=>{Array.from(E.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(j=>{j.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(De,{}),e(Zn,{className:"plain",children:"Experimental"}),e(ae,{disabled:!pe||ge,onClick:()=>{const R=Go(z.url);R?location.hash=R:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance",pe?e(x,{children:[" ","(",e("b",{children:pe}),")"]}):""]})]})]}),e(J,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),k.length&&z?e("ul",{class:`timeline flat contextual grow ${T==="loading"?"loading":""}`,children:[ke,W>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:T==="loading",onClick:()=>P(R=>R+St),style:{marginBlockEnd:"6em"},"data-state-post-ids":le.join(" "),children:[e("div",{class:"ib avatars-bunch",children:k.slice(Y,Y+5).map(R=>e(st,{url:R.account.avatarStatic},R.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:W>St?`${St}+`:W})]})]})})]}):e(x,{children:[T==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Le,{skeleton:!0,size:"l"})})}),T==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{S.reloadStatusPage++},children:"Try again"})]})]})]})}function bs({replies:t,instance:n,hasParentThread:s,level:o,accWeight:a,openAll:i,parentLink:h}){const[l,c]=We(),d=y=>y.reduce((k,v)=>{const{repliesCount:T,replies:$}=v,L=($==null?void 0:$.length)||T;return k+L+d($||[])},0),u=t.length+d(t),r=t.length===u,p=t.map(y=>y.account).filter((y,k,v)=>v.findIndex(T=>T.id===y.id)===k).slice(0,3),f=de(()=>t==null?void 0:t.reduce((y,k)=>y+(k==null?void 0:k.weight),a),[a,t==null?void 0:t.length]);let g=!1;(i||f<=oa||!s&&u===1&&mt(t[0])<2)&&(g=!0);const m=Vt[t[0].id],I=Ge((y,k,v,T)=>{y.preventDefault(),y.stopPropagation(),c({media:k+1,mediaStatusID:T.id})},[]),b=U();return Je(()=>{var k;function y(v){v.target.dataset.scrollLeft=v.target.scrollLeft}return(k=b.current)==null||k.addEventListener("scroll",y,{passive:!0}),()=>{var v;(v=b.current)==null||v.removeEventListener("scroll",y)}},[]),e("details",{ref:b,class:"replies",open:m||g,onToggle:y=>{const{open:k}=y.target;Vt[t[0].id]=k},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[e("summary",{class:"replies-summary",hidden:g,children:[e("span",{class:"avatars",children:p.map(y=>e(st,{url:y.avatarStatic,title:`${y.displayName} @${y.username}`,squircle:y==null?void 0:y.bot},y.id))}),e("span",{class:"replies-counts",children:[e("b",{children:[e("span",{title:t.length,children:ze(t.length)})," ","repl",t.length===1?"y":"ies"]}),!r&&u>1&&e(x,{children:[" ","·"," ",e("span",{children:[e("span",{title:u,children:ze(u)})," ","comment",u===1?"":"s"]})]})]}),e(w,{icon:"chevron-down",class:"replies-summary-chevron"}),!!h&&e(J,{class:"replies-parent-link",to:h.to,onClick:h.onClick,title:"View post with its replies",children:"»"})]}),e("ul",{children:t.map(y=>{var k,v;return e("li",{children:[e("div",{class:"status-focus",tabIndex:0,children:[e(Le,{statusID:y.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:I,showActionsBar:!0}),!((k=y.replies)!=null&&k.length)&&y.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:y.repliesCount,children:ze(y.repliesCount)})]})]}),((v=y.replies)==null?void 0:v.length)&&e(bs,{instance:n,replies:y.replies,level:o+1,accWeight:g?f:y.weight,openAll:i,parentLink:{to:n?`/${n}/s/${y.id}`:`/s/${y.id}`,onClick:()=>{Ct(y.id)}}})]},y.id)})})]})}const la=140,da=35,ua=70,ha=140,Gt=new Map;function mt(t){var f,g;const n=Gt.get(t.id);if(n)return n;const{spoilerText:s,content:o,mediaAttachments:a,poll:i,card:h}=t,l=Rs(s+o),c=a!=null&&a.length?la:0,d=(((f=i==null?void 0:i.options)==null?void 0:f.length)||0)*da,u=h&&(a!=null&&a.length||(g=i==null?void 0:i.options)!=null&&g.length)?0:ua,p=(l+c+d+u)/ha;return Gt.set(t.id,p),p}const fa=Be(aa);function pa(){const t=it(),{id:n,instance:s}=t;return e(fa,{id:n,instance:s})}const ma=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,ga=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,ba=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,ya=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,wa=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,va="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var Sa={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:ft,PHANPY_WEBSITE:Mn,PHANPY_PRIVACY_POLICY_URL:ka,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:Rn}=Sa,_n=Mn?Mn.replace(/https?:\/\//g,"").replace(/\/$/,""):null,En=`${"2024-02-25T12:33:02.277Z".slice(0,10).replace(/-/g,".")}.77818d3`;function Pn(){return _e(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:Wt,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:va,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),e("p",{children:e(J,{to:ft?`/login?instance=${ft}&submit=1`:"/login",class:"button",children:ft?"Log in":"Log in with Mastodon"})}),ft&&Rn&&e("p",{children:e("a",{href:Rn,class:"button plain5",children:"Sign up"})}),!ft&&e("p",{class:"insignificant",children:e("small",{children:["Connect your existing Mastodon/Fediverse account.",e("br",{}),"Your credentials are not stored on this server."]})})]}),(_n||En)&&e("p",{class:"app-site-version",children:e("small",{children:[_n," ",En]})}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),S.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:ka,target:"_blank",children:"Privacy Policy"}),"."]})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:ma,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:wa,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:ga,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:ba,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:ya,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Ia=window.alert;window.__nativeAlert||(window.__nativeAlert=Ia);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=Vs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=S;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(a=>{n[a]=Object.keys(S[a]).length});const{statuses:s}=S,o=[];for(const a in s)document.querySelector(`[data-state-post-id~="${a}"], [data-state-post-ids~="${a}"]`)||o.push(a)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:t,unfurledLinks:n,notifications:s}=S;let o=0;const{instance:a}=B();for(const i in t){if(!window.__IDLE__)break;try{const h=document.querySelector(`[data-state-post-id~="${i}"], [data-state-post-ids~="${i}"]`),l=s.some(c=>{var d;return i===Ye((d=c.status)==null?void 0:d.id,a)});if(!h&&!l){delete S.statuses[i],delete S.statusQuotes[i];for(const c in n){const d=n[c];if(Ye(d.id,d.instance)===i){delete S.unfurledLinks[c];break}}o++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const t in yt)queueMicrotask(()=>{var n,s,o,a;Array.isArray(yt[t])?(s=(n=yt[t])[0])==null||s.call(n):(a=(o=yt)[t])==null||a.call(o)})},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},o=Jn(n,3e3),a=()=>{window.__IDLE__=!1,o()};t.forEach(i=>{window.addEventListener(i,a,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",i=>{!i.relatedTarget&&!i.toElement&&n()},{passive:!0})})();const Ta=/iPad|iPhone|iPod/.test(navigator.userAgent);Ta&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const t=se.local.get("theme");let n;if(t){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const s=n.content,o=t==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=o||"",setTimeout(()=>{n.content=s},10)}}else{const s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${s}"]`),n){const o=n.dataset.content,a=n.dataset.contentTemp;n.content=a||"",setTimeout(()=>{n.content=o},10)}}}});{const t=se.local.get("theme");if(t){document.documentElement.classList.add(`is-${t}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",t||"dark light");const s=document.querySelector('meta[data-theme-setting="manual"]');s&&(s.name="theme-color",s.content=t==="light"?s.dataset.themeLightColor:s.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(a=>{a.name=""})}const n=se.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}Yn(S,t=>{var n;for(const[s,o,a,i]of t){if(o.join(".")==="settings.shortcutsViewMode"){const h=document.getElementById("app");h&&(h.dataset.shortcutsViewMode=(n=S.shortcuts)!=null&&n.length?a:"")}o.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",a)}});function Ca(){const[t,n]=C(!1),[s,o]=C("loading");H(()=>{const i=se.local.get("instanceURL"),h=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(h){window.history.replaceState({},document.title,window.location.pathname||"/");const l=se.session.get("clientID"),c=se.session.get("clientSecret"),d=se.session.get("vapidKey");(async()=>{o("loading");const{access_token:u}=await ea({instanceURL:i,client_id:l,client_secret:c,code:h}),r=_s({instance:i,accessToken:u});await Promise.allSettled([cn(r,i),Es(r,i,u,d)]),rn(),ln(r),n(!0),o("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const l=rt();if(l){se.session.set("currentAccount",l.info.id);const{client:c}=B({account:l}),{instance:d}=c;rn(),ln(c),o("loading"),(async()=>{try{await cn(c,d)}catch{}finally{n(!0),o("default")}})()}else o("default")}},[]);let a=ut();return S.currentLocation=a.pathname,H(zt,[a,t]),/\/https?:/.test(a.pathname)?e(jo,{}):e(x,{children:[e($a,{isLoggedIn:t,loading:s==="loading"}),e(xa,{isLoggedIn:t}),s==="default"&&e(Yt,{children:e(Te,{path:"/:instance?/s/:id",element:e(pa,{})})}),t&&e(Zs,{}),t&&e(Ki,{}),e(Vi,{}),t&&e(ji,{}),e(Ks,{isLoggedIn:t}),s!=="loading"&&e(Yi,{onClose:zt}),e(Js,{})]})}function $a({isLoggedIn:t,loading:n}){const s=ut(),o=de(()=>{const{pathname:a}=s;return!/^\/(login|welcome)/.test(a)},[s]);return e(Yt,{location:o||s,children:[e(Te,{path:"/",element:t?e(Ho,{}):n?e(we,{id:"loader-root"}):e(Pn,{})}),e(Te,{path:"/login",element:e(sa,{})}),e(Te,{path:"/welcome",element:e(Pn,{})})]})}function Dn(){return S.prevLocation||null}function xa({isLoggedIn:t}){const n=ut(),s=U(Dn());return de(()=>gt("/:instance/s/:id",n.pathname)||gt("/s/:id",n.pathname),[n.pathname,gt])?s.current||(s.current=Dn()):s.current=null,e(Yt,{location:s.current||n,children:[t&&e(x,{children:[e(Te,{path:"/notifications",element:e(fs,{})}),e(Te,{path:"/mentions",element:e(us,{})}),e(Te,{path:"/following",element:e(en,{})}),e(Te,{path:"/b",element:e(cs,{})}),e(Te,{path:"/f",element:e(rs,{})}),e(Te,{path:"/l",children:[e(Te,{index:!0,element:e(Yo,{})}),e(Te,{path:":id",element:e(ds,{})})]}),e(Te,{path:"/ft",element:e(bo,{})})]}),e(Te,{path:"/:instance?/t/:hashtag",element:e(ls,{})}),e(Te,{path:"/:instance?/a/:id",element:e(fo,{})}),e(Te,{path:"/:instance?/p",children:[e(Te,{index:!0,element:e(Ht,{})}),e(Te,{path:"l",element:e(Ht,{local:!0})})]}),e(Te,{path:"/:instance?/trending",element:e(ms,{})}),e(Te,{path:"/:instance?/search",element:e(ps,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));js(e(Gs,{children:e(Ca,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-7VXRc2Lt.js.map
